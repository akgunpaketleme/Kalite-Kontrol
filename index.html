<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKG Takip Sistemi - Firebase</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: #333; 
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header { 
            background: linear-gradient(135deg, #2c3e50, #34495e); 
            color: white; 
            padding: 25px; 
            border-radius: 15px; 
            text-align: center; 
            margin-bottom: 30px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.2); 
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .header .status { font-size: 14px; color: #95a5a6; margin-top: 10px; }
        .header .status.connected { color: #2ecc71; }
        
        .tabs { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin-bottom: 25px; 
            justify-content: center; 
        }
        .tab { 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white; 
            border: none; 
            padding: 15px 25px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); 
        }
        .tab:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4); }
        .tab.active { background: linear-gradient(135deg, #e74c3c, #c0392b); box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4); }
        
        .tab-content { 
            display: none; 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
        }
        .tab-content.active { display: block; }
        .tab-content h2 { 
            color: #2c3e50; 
            margin-bottom: 25px; 
            font-size: 2em; 
            text-align: center; 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
        }
        
        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 25px; 
        }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: 600; margin-bottom: 8px; color: #2c3e50; font-size: 1.1em; }
        .form-group input, .form-group select, .form-group textarea { 
            padding: 12px; 
            border: 2px solid #bdc3c7; 
            border-radius: 8px; 
            font-size: 16px; 
            transition: all 0.3s ease; 
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            outline: none; 
            border-color: #3498db; 
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3); 
        }
        
        .btn { 
            background: linear-gradient(135deg, #27ae60, #2ecc71); 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3); 
            margin: 5px; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4); }
        .btn-success { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-edit { 
            background: linear-gradient(135deg, #f39c12, #e67e22); 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            transition: all 0.3s ease; 
        }
        .btn-delete { 
            background: linear-gradient(135deg, #e74c3c, #c0392b); 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            transition: all 0.3s ease; 
        }
        
        .alert { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: 600; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .kayit-item { 
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.1); 
        }
        .kayit-header { 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white; 
            padding: 12px 15px; 
            border-radius: 6px; 
            margin-bottom: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-weight: 600; 
        }
        .kayit-details { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            color: #2c3e50; 
        }
        
        /* GÃ¶rev (GÃ¼ncel Ä°ÅŸler) Stilleri */
        .gorev-item { 
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            padding: 15px; 
            margin-bottom: 10px; 
            cursor: move; 
            transition: all 0.3s ease; 
        }
        .gorev-item:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-color: #3498db; }
        .gorev-item.tamamlandi { opacity: 0.6; background: #f0f9f0; }
        .gorev-item.tamamlandi .gorev-baslik { text-decoration: line-through; }
        .gorev-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .gorev-baslik { font-weight: 600; font-size: 1.1em; color: #2c3e50; }
        .aciliyet-badge { 
            padding: 4px 12px; 
            border-radius: 15px; 
            font-size: 12px; 
            font-weight: bold; 
            color: white; 
        }
        .aciliyet-badge.acil { background: #e74c3c; }
        .aciliyet-badge.normal { background: #3498db; }
        .aciliyet-badge.dusuk { background: #95a5a6; }
        .gorev-not-item { 
            background: white; 
            padding: 8px; 
            margin: 5px 0; 
            border-radius: 4px; 
            border-left: 3px solid #3498db; 
        }
        
        /* SipariÅŸ Durumu Badge'leri */
        .durum-badge { 
            padding: 5px 12px; 
            border-radius: 15px; 
            font-size: 13px; 
            font-weight: bold; 
            color: white; 
            display: inline-block; 
        }
        .durum-badge.bekleniyor { background: #f39c12; }
        .durum-badge.geldi { background: #27ae60; }
        .durum-badge.iptal { background: #95a5a6; }
        
        /* Stok YÃ¶netimi Stilleri */
        .stok-kayit-item { 
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            transition: all 0.3s ease; 
        }
        .stok-kayit-item:hover { border-color: #3498db; box-shadow: 0 6px 20px rgba(52, 152, 219, 0.2); }
        .stok-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 2px solid #ecf0f1; 
        }
        .stok-bilgi { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        .stok-bilgi-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px; 
            background: #f8f9fa; 
            border-radius: 6px; 
            border-left: 4px solid #3498db; 
        }
        .stok-kontrol { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 15px; 
            padding: 15px; 
            background: #ecf0f1; 
            border-radius: 8px; 
        }
        .stok-adet-display { 
            background: white; 
            padding: 8px 15px; 
            border: 2px solid #3498db; 
            border-radius: 6px; 
            font-weight: bold; 
            font-size: 1.2em; 
            color: #2c3e50; 
            min-width: 60px; 
            text-align: center; 
        }
        .stok-adet-input { 
            width: 100px; 
            padding: 8px; 
            text-align: center; 
            border: 2px solid #3498db; 
            border-radius: 6px; 
            font-weight: bold; 
        }
        
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .tab { width: 100%; margin-bottom: 5px; }
            .stok-bilgi { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ AKG Takip Sistemi</h1>
            <div class="status" id="connectionStatus">ğŸ”„ BaÄŸlanÄ±yor...</div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('guncel-isler')">ğŸ“‹ GÃ¼ncel Ä°ÅŸler</button>
            <button class="tab" onclick="showTab('siparis-hazirlik')">ğŸ“¦ SipariÅŸ HazÄ±rlÄ±ÄŸÄ±</button>
            <button class="tab" onclick="showTab('siparisler')">ğŸ›’ SipariÅŸler</button>
            <button class="tab" onclick="showTab('stok')">ğŸ“Š Stok YÃ¶netimi</button>
        </div>

        <!-- GÃ¼ncel Ä°ÅŸler Tab -->
        <div id="guncel-isler" class="tab-content active">
            <h2>ğŸ“‹ GÃ¼ncel Ä°ÅŸler</h2>
            
            <form id="gorevEkleForm">
                <h3>â• Yeni GÃ¶rev Ekle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="gorevBaslik">ğŸ“ GÃ¶rev BaÅŸlÄ±ÄŸÄ±</label>
                        <input type="text" id="gorevBaslik" placeholder="GÃ¶rev baÅŸlÄ±ÄŸÄ±nÄ± girin" required>
                    </div>
                    <div class="form-group">
                        <label for="gorevAciliyet">âš ï¸ Aciliyet</label>
                        <select id="gorevAciliyet" required>
                            <option value="acil">ğŸ”´ Acil</option>
                            <option value="normal" selected>ğŸ”µ Normal</option>
                            <option value="dusuk">âšª DÃ¼ÅŸÃ¼k</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gorevAtanan">ğŸ‘¤ Atanan KiÅŸi</label>
                        <select id="gorevAtanan">
                            <option value="">Herkes</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gorevAciklama">ğŸ“„ AÃ§Ä±klama</label>
                        <textarea id="gorevAciklama" rows="3" placeholder="GÃ¶rev detaylarÄ±..."></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">â• GÃ¶rev Ekle</button>
            </form>
            <div id="gorevAlert"></div>

            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="siralaGorevler('aciliyet')">âš ï¸ Aciliyete GÃ¶re SÄ±rala</button>
                <button class="btn" onclick="siralaGorevler('tarih')">ğŸ“… Tarihe GÃ¶re SÄ±rala</button>
                <button class="btn btn-danger" onclick="tamamlananGizle()">ğŸ‘ï¸ TamamlananlarÄ± Gizle/GÃ¶ster</button>
            </div>

            <div id="gorevlerListesi"></div>
        </div>

        <!-- SipariÅŸ HazÄ±rlÄ±ÄŸÄ± Tab -->
        <div id="siparis-hazirlik" class="tab-content">
            <h2>ğŸ“¦ SipariÅŸ HazÄ±rlÄ±ÄŸÄ±</h2>
            
            <form id="siparisEkleForm">
                <h3>â• Yeni SipariÅŸ Ekle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="hazirlikTarih">ğŸ“… Tarih</label>
                        <input type="date" id="hazirlikTarih" required>
                    </div>
                    <div class="form-group">
                        <label for="hazirlikOperator">ğŸ‘¤ OperatÃ¶r</label>
                        <select id="hazirlikOperator" required>
                            <option value="">OperatÃ¶r seÃ§in</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hazirlikSiparisNo">ğŸ”¢ SipariÅŸ No</label>
                        <input type="text" id="hazirlikSiparisNo" placeholder="SipariÅŸ numarasÄ±" required>
                    </div>
                    <div class="form-group">
                        <label for="urunKoduSiparis">ğŸ“¦ ÃœrÃ¼n Kodu</label>
                        <input type="text" id="urunKoduSiparis" placeholder="ÃœrÃ¼n kodu" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisAdet">ğŸ“Š SipariÅŸ Adedi</label>
                        <input type="number" id="siparisAdet" min="1" placeholder="Toplam adet" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisNotlar">ğŸ“ Notlar</label>
                        <textarea id="siparisNotlar" rows="3" placeholder="SipariÅŸ notlarÄ±..."></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">â• SipariÅŸ Ekle</button>
            </form>
            <div id="siparisEkleAlert"></div>

            <div id="siparislerContainer">
                <h3>ğŸ“‹ Mevcut SipariÅŸler</h3>
                <div id="siparislerListesi"></div>
            </div>
        </div>

        <!-- ÃœrÃ¼n SipariÅŸleri Tab -->
        <div id="siparisler" class="tab-content">
            <h2>ğŸ›’ ÃœrÃ¼n SipariÅŸleri</h2>
            
            <form id="urunSiparisForm">
                <h3>â• Yeni ÃœrÃ¼n SipariÅŸi</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="siparisUrunAdi">ğŸ“¦ ÃœrÃ¼n AdÄ±</label>
                        <input type="text" id="siparisUrunAdi" placeholder="ÃœrÃ¼n adÄ±" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisAdetMiktar">ğŸ“Š Adet / Miktar</label>
                        <input type="text" id="siparisAdetMiktar" placeholder="Ã–rn: 100 adet" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisOlcu">ğŸ“ Ã–lÃ§Ã¼</label>
                        <input type="text" id="siparisOlcu" placeholder="Ã–rn: 25x15 cm">
                    </div>
                    <div class="form-group">
                        <label for="siparisAciklama">ğŸ“ AÃ§Ä±klama / Not</label>
                        <textarea id="siparisAciklama" rows="3" placeholder="SipariÅŸ detaylarÄ±..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="siparisTalipEden">ğŸ‘¤ Talep Eden</label>
                        <select id="siparisTalipEden" required>
                            <option value="">KiÅŸi seÃ§in</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">â• SipariÅŸ Ekle</button>
            </form>
            <div id="siparisAlert"></div>

            <div style="margin: 20px 0;">
                <label style="font-weight: 600; margin-right: 10px;">Filtre:</label>
                <button class="btn" onclick="filtreSiparisler('hepsi')">TÃ¼mÃ¼</button>
                <button class="btn btn-success" onclick="filtreSiparisler('bekleniyor')">Bekleniyor</button>
                <button class="btn btn-success" onclick="filtreSiparisler('geldi')">Geldi</button>
                <button class="btn btn-danger" onclick="filtreSiparisler('iptal')">Ä°ptal</button>
            </div>

            <div id="urunSiparislerListesi"></div>
        </div>

        <!-- Stok YÃ¶netimi Tab -->
        <div id="stok" class="tab-content">
            <h2>ğŸ“Š Stok YÃ¶netimi</h2>
            
            <form id="stokForm">
                <h3>â• Stok Ekle/GÃ¼ncelle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="stokMalzemeTuru">ğŸ”§ Malzeme TÃ¼rÃ¼</label>
                        <select id="stokMalzemeTuru" required>
                            <option value="">Malzeme tÃ¼rÃ¼nÃ¼ seÃ§in</option>
                            <option value="izolasyon">Ä°zolasyon</option>
                            <option value="koli">Koli</option>
                            <option value="kutu">Kutu</option>
                            <option value="poset">PoÅŸet</option>
                            <option value="tapa">Tapa</option>
                            <option value="etiket">Etiket</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stokUrunAdi">ğŸ“¦ ÃœrÃ¼n AdÄ±</label>
                        <input type="text" id="stokUrunAdi" placeholder="ÃœrÃ¼n adÄ±nÄ± yazÄ±n" required>
                    </div>
                    <div class="form-group">
                        <label for="stokOlculeri">ğŸ“ Ã–lÃ§Ã¼ler (Ä°steÄŸe BaÄŸlÄ±)</label>
                        <input type="text" id="stokOlculeri" placeholder="Ã–rn: 25x15x10 cm">
                    </div>
                    <div class="form-group">
                        <label for="stokMevcut">ğŸ“Š Mevcut Adet</label>
                        <input type="number" id="stokMevcut" placeholder="Mevcut adet" required>
                    </div>
                    <div class="form-group">
                        <label for="stokEkleyen">ğŸ‘¤ Verileri Ekleyen</label>
                        <select id="stokEkleyen" required>
                            <option value="">KiÅŸi seÃ§in</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn">ğŸ’¾ Stok Kaydet</button>
                    <button type="button" class="btn btn-success" onclick="temizleStokFormu()">ğŸ§¹ Formu Temizle</button>
                </div>
            </form>
            <div id="stokAlert"></div>

            <div id="stokListesiContainer">
                <h3>ğŸ“‹ KayÄ±tlÄ± Stoklar</h3>
                <div id="stokListesi"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDJYEEnWdlfzCVFg-w_IIWE5QbNFzN9hqA",
            authDomain: "akgkalitekontrol.firebaseapp.com",
            databaseURL: "https://akgkalitekontrol-default-rtdb.firebaseio.com",
            projectId: "akgkalitekontrol",
            storageBucket: "akgkalitekontrol.firebasestorage.app",
            messagingSenderId: "315960243910",
            appId: "1:315960243910:web:bb97b559d7d6648e5fc9c7",
            measurementId: "G-BX4HH38KHE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Connection Status
        const connectedRef = database.ref('.info/connected');
        connectedRef.on('value', (snap) => {
            const statusEl = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                statusEl.textContent = 'âœ… BaÄŸlÄ± - Realtime Database Aktif';
                statusEl.className = 'status connected';
            } else {
                statusEl.textContent = 'âŒ BaÄŸlantÄ± Kesildi';
                statusEl.className = 'status';
            }
        });

        // Global deÄŸiÅŸkenler
        let tamamlananlariGoster = true;
        let currentSiparisFilter = 'hepsi';

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().slice(0, 10);
            document.getElementById('hazirlikTarih').value = today;

            // Firebase listeners
            listenToGorevler();
            listenToSiparisHazirlik();
            listenToUrunSiparisler();
            listenToStok();

            // Form listeners
            document.getElementById('gorevEkleForm').addEventListener('submit', gorevEkle);
            document.getElementById('siparisEkleForm').addEventListener('submit', siparisEkle);
            document.getElementById('urunSiparisForm').addEventListener('submit', urunSiparisEkle);
            document.getElementById('stokForm').addEventListener('submit', stokEkleGuncelle);
        });

        // ==================== GÃœNCEL Ä°ÅLER ====================
        function listenToGorevler() {
            database.ref('gorevler').on('value', (snapshot) => {
                const gorevler = [];
                snapshot.forEach((childSnapshot) => {
                    gorevler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadGorevlerListesi(gorevler);
            });
        }

        function gorevEkle(e) {
            e.preventDefault();
            
            const gorevData = {
                baslik: document.getElementById('gorevBaslik').value.trim(),
                aciliyet: document.getElementById('gorevAciliyet').value,
                atanan: document.getElementById('gorevAtanan').value,
                aciklama: document.getElementById('gorevAciklama').value.trim(),
                tamamlandi: false,
                notlar: [],
                olusturmaTarihi: new Date().toISOString(),
                sira: Date.now()
            };

            database.ref('gorevler').push(gorevData)
                .then(() => {
                    document.getElementById('gorevEkleForm').reset();
                    showAlert('gorevAlert', 'GÃ¶rev baÅŸarÄ±yla eklendi!', 'success');
                })
                .catch((error) => {
                    showAlert('gorevAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function loadGorevlerListesi(gorevler) {
            const container = document.getElementById('gorevlerListesi');
            if (!container) return;

            let filtrelenmisGorevler = gorevler;
            if (!tamamlananlariGoster) {
                filtrelenmisGorevler = gorevler.filter(g => !g.tamamlandi);
            }

            if (filtrelenmisGorevler.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z gÃ¶rev bulunmuyor.</p>';
                return;
            }

            let html = '<div style="margin-top: 20px;">';
            filtrelenmisGorevler.forEach(gorev => {
                const aciliyetClass = gorev.aciliyet === 'acil' ? 'acil' : gorev.aciliyet === 'normal' ? 'normal' : 'dusuk';
                const aciliyetText = gorev.aciliyet === 'acil' ? 'ğŸ”´ Acil' : gorev.aciliyet === 'normal' ? 'ğŸ”µ Normal' : 'âšª DÃ¼ÅŸÃ¼k';
                
                html += `
                    <div class="gorev-item ${gorev.tamamlandi ? 'tamamlandi' : ''}">
                        <div class="gorev-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" ${gorev.tamamlandi ? 'checked' : ''} onchange="toggleGorevTamamlandi('${gorev.id}')" style="transform: scale(1.3);">
                                <div class="gorev-baslik">${gorev.baslik}</div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="aciliyet-badge ${aciliyetClass}">${aciliyetText}</span>
                                ${gorev.atanan ? `<span style="background: #3498db; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px;">ğŸ‘¤ ${gorev.atanan}</span>` : ''}
                                <button class="btn-delete" onclick="gorevSil('${gorev.id}')" style="padding: 5px 10px;">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        ${gorev.aciklama ? `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 14px;">${gorev.aciklama}</div>` : ''}
                        
                        <div style="margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;">
                            <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <input type="text" id="not-input-${gorev.id}" placeholder="Not ekle..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                                <button class="btn" onclick="gorevNotEkle('${gorev.id}')" style="padding: 8px 15px; font-size: 13px;">â• Not</button>
                            </div>
                            ${gorev.notlar && gorev.notlar.length > 0 ? `
                                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-top: 10px;">
                                    ${gorev.notlar.map((not, index) => `
                                        <div class="gorev-not-item">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <div style="flex: 1;">
                                                    <strong style="font-size: 12px; color: #3498db;">${not.ekleyen} - ${new Date(not.tarih).toLocaleString('tr-TR')}</strong>
                                                    <div>${not.metin}</div>
                                                </div>
                                                <button onclick="gorevNotSil('${gorev.id}', ${index})" style="background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 16px;">âŒ</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function toggleGorevTamamlandi(id) {
            database.ref('gorevler/' + id).once('value').then((snapshot) => {
                const gorev = snapshot.val();
                database.ref('gorevler/' + id).update({
                    tamamlandi: !gorev.tamamlandi
                });
            });
        }

        function gorevNotEkle(id) {
            const input = document.getElementById(`not-input-${id}`);
            const notMetin = input.value.trim();
            if (!notMetin) return;

            database.ref('gorevler/' + id + '/notlar').once('value').then((snapshot) => {
                const notlar = snapshot.val() || [];
                notlar.push({
                    metin: notMetin,
                    ekleyen: 'KullanÄ±cÄ±',
                    tarih: new Date().toISOString()
                });
                database.ref('gorevler/' + id).update({ notlar });
                input.value = '';
            });
        }

        function gorevNotSil(gorevId, notIndex) {
            database.ref('gorevler/' + gorevId + '/notlar').once('value').then((snapshot) => {
                const notlar = snapshot.val() || [];
                notlar.splice(notIndex, 1);
                database.ref('gorevler/' + gorevId).update({ notlar });
            });
        }

        function gorevSil(id) {
            if (confirm('Bu gÃ¶revi silmek istediÄŸinizden emin misiniz?')) {
                database.ref('gorevler/' + id).remove()
                    .then(() => showAlert('gorevAlert', 'GÃ¶rev silindi!', 'success'))
                    .catch((error) => showAlert('gorevAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        function siralaGorevler(tip) {
            database.ref('gorevler').once('value').then((snapshot) => {
                const gorevler = [];
                snapshot.forEach((childSnapshot) => {
                    gorevler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });

                if (tip === 'aciliyet') {
                    const aciliyetSirasi = { 'acil': 1, 'normal': 2, 'dusuk': 3 };
                    gorevler.sort((a, b) => aciliyetSirasi[a.aciliyet] - aciliyetSirasi[b.aciliyet]);
                } else if (tip === 'tarih') {
                    gorevler.sort((a, b) => new Date(b.olusturmaTarihi) - new Date(a.olusturmaTarihi));
                }

                loadGorevlerListesi(gorevler);
            });
        }

        function tamamlananGizle() {
            tamamlananlariGoster = !tamamlananlariGoster;
            listenToGorevler();
        }

        // ==================== SÄ°PARÄ°Å HAZIRLIK ====================
        function listenToSiparisHazirlik() {
            database.ref('siparisHazirlik').on('value', (snapshot) => {
                const siparisler = [];
                snapshot.forEach((childSnapshot) => {
                    siparisler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadSiparislerListesi(siparisler);
            });
        }

        function siparisEkle(e) {
            e.preventDefault();
            
            const siparisData = {
                tarih: document.getElementById('hazirlikTarih').value,
                operator: document.getElementById('hazirlikOperator').value,
                siparisNo: document.getElementById('hazirlikSiparisNo').value.trim(),
                urunKodu: document.getElementById('urunKoduSiparis').value.trim(),
                siparisAdet: parseInt(document.getElementById('siparisAdet').value),
                notlar: document.getElementById('siparisNotlar').value.trim(),
                durum: 'beklemede',
                olusturmaTarihi: new Date().toISOString()
            };

            database.ref('siparisHazirlik').push(siparisData)
                .then(() => {
                    document.getElementById('siparisEkleForm').reset();
                    const today = new Date().toISOString().slice(0, 10);
                    document.getElementById('hazirlikTarih').value = today;
                    showAlert('siparisEkleAlert', 'SipariÅŸ baÅŸarÄ±yla eklendi!', 'success');
                })
                .catch((error) => {
                    showAlert('siparisEkleAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function loadSiparislerListesi(siparisler) {
            const container = document.getElementById('siparislerListesi');
            if (!container) return;

            if (siparisler.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z sipariÅŸ bulunmuyor.</p>';
                return;
            }

            let html = '';
            siparisler.slice().reverse().forEach(siparis => {
                html += `
                    <div class="kayit-item">
                        <div class="kayit-header">
                            <div><strong>ğŸ”¢ ${siparis.siparisNo} - ğŸ“¦ ${siparis.urunKodu}</strong></div>
                            <div>
                                <button class="btn-delete" onclick="siparisSil('${siparis.id}')" style="margin-left: 5px;">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <div class="kayit-details">
                            <div><strong>ğŸ“… Tarih:</strong> ${new Date(siparis.tarih).toLocaleDateString('tr-TR')}</div>
                            <div><strong>ğŸ‘¤ OperatÃ¶r:</strong> ${siparis.operator}</div>
                            <div><strong>ğŸ“Š SipariÅŸ Adedi:</strong> ${siparis.siparisAdet}</div>
                            <div><strong>ğŸ“Š Durum:</strong> ${siparis.durum === 'tamamlandi' ? 'âœ… TamamlandÄ±' : 'â³ Beklemede'}</div>
                            ${siparis.notlar ? `<div style="grid-column: 1/-1;"><strong>ğŸ“ Notlar:</strong> ${siparis.notlar}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function siparisSil(id) {
            if (confirm('Bu sipariÅŸi silmek istediÄŸinizden emin misiniz?')) {
                database.ref('siparisHazirlik/' + id).remove()
                    .then(() => showAlert('siparisEkleAlert', 'SipariÅŸ silindi!', 'success'))
                    .catch((error) => showAlert('siparisEkleAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        // ==================== ÃœRÃœN SÄ°PARÄ°ÅLERÄ° ====================
        function listenToUrunSiparisler() {
            database.ref('urunSiparisler').on('value', (snapshot) => {
                const siparisler = [];
                snapshot.forEach((childSnapshot) => {
                    siparisler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadUrunSiparislerListesi(siparisler);
            });
        }

        function urunSiparisEkle(e) {
            e.preventDefault();
            
            const siparisData = {
                urunAdi: document.getElementById('siparisUrunAdi').value.trim(),
                adetMiktar: document.getElementById('siparisAdetMiktar').value.trim(),
                olcu: document.getElementById('siparisOlcu').value.trim(),
                aciklama: document.getElementById('siparisAciklama').value.trim(),
                talepEden: document.getElementById('siparisTalipEden').value,
                durum: 'bekleniyor',
                olusturmaTarihi: new Date().toISOString(),
                gelenAdet: '',
                gelenNotlar: ''
            };

            database.ref('urunSiparisler').push(siparisData)
                .then(() => {
                    document.getElementById('urunSiparisForm').reset();
                    showAlert('siparisAlert', 'SipariÅŸ baÅŸarÄ±yla eklendi!', 'success');
                })
                .catch((error) => {
                    showAlert('siparisAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function loadUrunSiparislerListesi(siparisler) {
            const container = document.getElementById('urunSiparislerListesi');
            if (!container) return;

            let filtrelenmissiparisler = siparisler;
            if (currentSiparisFilter !== 'hepsi') {
                filtrelenmissiparisler = siparisler.filter(s => s.durum === currentSiparisFilter);
            }

            if (filtrelenmissiparisler.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z sipariÅŸ bulunmuyor.</p>';
                return;
            }

            let html = '<div style="margin-top: 20px;">';
            filtrelenmissiparisler.slice().reverse().forEach(siparis => {
                const durumText = siparis.durum === 'bekleniyor' ? 'Bekleniyor' : 
                                  siparis.durum === 'geldi' ? 'Geldi' : 'Ä°ptal';
                
                html += `
                    <div class="kayit-item">
                        <div class="kayit-header">
                            <div><strong>ğŸ“¦ ${siparis.urunAdi}</strong></div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="durum-badge ${siparis.durum}">${durumText}</span>
                                <button class="btn-delete" onclick="urunSiparisSil('${siparis.id}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <div class="kayit-details">
                            <div><strong>ğŸ“Š Adet/Miktar:</strong> ${siparis.adetMiktar}</div>
                            ${siparis.olcu ? `<div><strong>ğŸ“ Ã–lÃ§Ã¼:</strong> ${siparis.olcu}</div>` : ''}
                            <div><strong>ğŸ‘¤ Talep Eden:</strong> ${siparis.talepEden}</div>
                            <div><strong>ğŸ“… Tarih:</strong> ${new Date(siparis.olusturmaTarihi).toLocaleString('tr-TR')}</div>
                            ${siparis.aciklama ? `<div style="grid-column: 1/-1;"><strong>ğŸ“ AÃ§Ä±klama:</strong> ${siparis.aciklama}</div>` : ''}
                            ${siparis.gelenAdet ? `<div><strong>âœ… Gelen Adet:</strong> ${siparis.gelenAdet}</div>` : ''}
                            ${siparis.gelenNotlar ? `<div style="grid-column: 1/-1;"><strong>ğŸ“Œ Notlar:</strong> ${siparis.gelenNotlar}</div>` : ''}
                        </div>
                        ${siparis.durum === 'bekleniyor' ? `
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-success" onclick="siparisGeldi('${siparis.id}', '${siparis.adetMiktar}')">âœ… Geldi Olarak Ä°ÅŸaretle</button>
                                <button class="btn btn-danger" onclick="siparisIptal('${siparis.id}')">âŒ Ä°ptal Et</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function siparisGeldi(id, defaultAdet) {
            const gelenAdet = prompt('Gelen adet/miktarÄ± girin:', defaultAdet);
            if (gelenAdet === null) return;

            const notlar = prompt('Not eklemek ister misiniz?', '');

            database.ref('urunSiparisler/' + id).update({
                durum: 'geldi',
                gelenAdet: gelenAdet,
                gelenNotlar: notlar || '',
                gelisTarihi: new Date().toISOString()
            }).then(() => {
                showAlert('siparisAlert', 'SipariÅŸ "Geldi" olarak iÅŸaretlendi!', 'success');
            });
        }

        function siparisIptal(id) {
            if (confirm('Bu sipariÅŸi iptal etmek istediÄŸinizden emin misiniz?')) {
                database.ref('urunSiparisler/' + id).update({
                    durum: 'iptal'
                }).then(() => {
                    showAlert('siparisAlert', 'SipariÅŸ iptal edildi!', 'success');
                });
            }
        }

        function urunSiparisSil(id) {
            if (confirm('Bu sipariÅŸi silmek istediÄŸinizden emin misiniz?')) {
                database.ref('urunSiparisler/' + id).remove()
                    .then(() => showAlert('siparisAlert', 'SipariÅŸ silindi!', 'success'))
                    .catch((error) => showAlert('siparisAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        function filtreSiparisler(durum) {
            currentSiparisFilter = durum;
            listenToUrunSiparisler();
        }

        // ==================== STOK YÃ–NETÄ°MÄ° ====================
        function listenToStok() {
            database.ref('stok').on('value', (snapshot) => {
                const stoklar = [];
                snapshot.forEach((childSnapshot) => {
                    stoklar.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadStokListesi(stoklar);
            });
        }

        function stokEkleGuncelle(e) {
            if (e) e.preventDefault();
            
            const malzemeTuru = document.getElementById('stokMalzemeTuru').value;
            const urunAdi = document.getElementById('stokUrunAdi').value.trim();
            const olculeri = document.getElementById('stokOlculeri').value.trim();
            const mevcutAdet = parseInt(document.getElementById('stokMevcut').value);
            const ekleyen = document.getElementById('stokEkleyen').value;

            if (!malzemeTuru || !urunAdi || !ekleyen || isNaN(mevcutAdet)) {
                showAlert('stokAlert', 'LÃ¼tfen tÃ¼m gerekli alanlarÄ± doldurunuz!', 'error');
                return;
            }

            // AynÄ± Ã¼rÃ¼n var mÄ± kontrol et
            database.ref('stok').orderByChild('urunAdi').equalTo(urunAdi).once('value').then((snapshot) => {
                let existingId = null;
                snapshot.forEach((childSnapshot) => {
                    const stok = childSnapshot.val();
                    if (stok.malzemeTuru === malzemeTuru && stok.olculeri === olculeri) {
                        existingId = childSnapshot.key;
                    }
                });

                const yeniStok = {
                    malzemeTuru: malzemeTuru,
                    urunAdi: urunAdi,
                    olculeri: olculeri,
                    mevcutAdet: mevcutAdet,
                    ekleyen: ekleyen,
                    sonGuncelleme: new Date().toISOString()
                };

                if (existingId) {
                    database.ref('stok/' + existingId).update(yeniStok)
                        .then(() => {
                            showAlert('stokAlert', 'Stok baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                            temizleStokFormu();
                        });
                } else {
                    database.ref('stok').push(yeniStok)
                        .then(() => {
                            showAlert('stokAlert', 'Stok baÅŸarÄ±yla eklendi!', 'success');
                            temizleStokFormu();
                        });
                }
            });
        }

        function loadStokListesi(stoklar) {
            const container = document.getElementById('stokListesi');
            if (!container) return;

            if (stoklar.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z stok kaydÄ± bulunmuyor.</p>';
                return;
            }

            let html = '';
            stoklar.forEach(stok => {
                html += `
                    <div class="stok-kayit-item">
                        <div class="stok-header">
                            <h4>ğŸ“¦ ${stok.urunAdi}</h4>
                            <span style="background: #3498db; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                                ${stok.malzemeTuru.toUpperCase()}
                            </span>
                        </div>
                        <div class="stok-bilgi">
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ“ Ã–lÃ§Ã¼ler:</strong></span>
                                <span>${stok.olculeri || 'BelirtilmemiÅŸ'}</span>
                            </div>
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ“Š Mevcut Adet:</strong></span>
                                <span style="font-weight: bold; color: ${stok.mevcutAdet > 0 ? '#27ae60' : stok.mevcutAdet < 0 ? '#e74c3c' : '#f39c12'};">
                                    ${stok.mevcutAdet}
                                </span>
                            </div>
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ‘¤ Ekleyen:</strong></span>
                                <span>${stok.ekleyen}</span>
                            </div>
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ•’ Son GÃ¼ncelleme:</strong></span>
                                <span>${new Date(stok.sonGuncelleme).toLocaleString('tr-TR')}</span>
                            </div>
                        </div>
                        
                        <!-- Eklenen Adet -->
                        <div style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px; border: 2px solid #27ae60;">
                            <label style="font-weight: 600; display: block; margin-bottom: 5px; color: #27ae60;">â• Eklenen Adet:</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="stok-adet-input" id="eklenen-${stok.id}" placeholder="Eklenecek adet" min="0" style="border-color: #27ae60;">
                                <button class="btn btn-success" onclick="stokEkle('${stok.id}')" style="padding: 5px 15px;">â• Ekle</button>
                            </div>
                        </div>

                        <!-- KullanÄ±lan Adet -->
                        <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 6px; border: 2px solid #f39c12;">
                            <label style="font-weight: 600; display: block; margin-bottom: 5px; color: #f39c12;">ğŸ“‰ KullanÄ±lan Adet:</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="stok-adet-input" id="kullanilan-${stok.id}" placeholder="KullanÄ±lan adet" min="0" style="border-color: #f39c12;">
                                <button class="btn" onclick="stokKullan('${stok.id}')" style="padding: 5px 15px; background: linear-gradient(135deg, #f39c12, #e67e22);">â– Kullan</button>
                            </div>
                        </div>

                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn-delete" onclick="stokSil('${stok.id}')">ğŸ—‘ï¸ Sil</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function stokEkle(id) {
            const input = document.getElementById(`eklenen-${id}`);
            const eklenenAdet = parseInt(input.value);
            
            if (isNaN(eklenenAdet) || eklenenAdet <= 0) {
                alert('LÃ¼tfen geÃ§erli bir adet giriniz!');
                return;
            }

            database.ref('stok/' + id).once('value').then((snapshot) => {
                const stok = snapshot.val();
                const yeniAdet = stok.mevcutAdet + eklenenAdet;
                
                database.ref('stok/' + id).update({
                    mevcutAdet: yeniAdet,
                    sonGuncelleme: new Date().toISOString()
                }).then(() => {
                    input.value = '';
                    showAlert('stokAlert', `${eklenenAdet} adet eklendi. Yeni stok: ${yeniAdet}`, 'success');
                });
            });
        }

        function stokKullan(id) {
            const input = document.getElementById(`kullanilan-${id}`);
            const kullanilanAdet = parseInt(input.value);
            
            if (isNaN(kullanilanAdet) || kullanilanAdet <= 0) {
                alert('LÃ¼tfen geÃ§erli bir adet giriniz!');
                return;
            }

            database.ref('stok/' + id).once('value').then((snapshot) => {
                const stok = snapshot.val();
                const yeniAdet = stok.mevcutAdet - kullanilanAdet;
                
                database.ref('stok/' + id).update({
                    mevcutAdet: yeniAdet,
                    sonGuncelleme: new Date().toISOString()
                }).then(() => {
                    input.value = '';
                    showAlert('stokAlert', `${kullanilanAdet} adet kullanÄ±ldÄ±. Yeni stok: ${yeniAdet}`, 'success');
                });
            });
        }

        function stokSil(id) {
            if (confirm('Bu stok kaydÄ±nÄ± silmek istediÄŸinizden emin misiniz?')) {
                database.ref('stok/' + id).remove()
                    .then(() => showAlert('stokAlert', 'Stok kaydÄ± silindi!', 'success'))
                    .catch((error) => showAlert('stokAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        function temizleStokFormu() {
            document.getElementById('stokForm').reset();
        }

        // ==================== GENEL FONKSÄ°YONLAR ====================
        function showTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }
    </script>
</body>
</html>
