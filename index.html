<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalite Kontrol ve Paketleme Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #34495e;
            overflow-x: auto;
            padding: 0 20px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .hata-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        
        .hata-container h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .hata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .hata-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .hata-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .hata-item label {
            flex: 1;
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }
        
        .hata-adet {
            width: 60px;
            margin-left: 10px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .kayit-item {
            background: white;
            border: 1px solid #e0e6ed;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .kayit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .kayit-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .diger-hata {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
        }
        
        .diger-hata input {
            width: 100%;
            margin-top: 5px;
        }

        .responsive-table {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e6ed;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        tr:hover {
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .hata-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                padding: 0 10px;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 0.9em;
            }
            
            .container {
                margin: 5px;
                border-radius: 10px;
            }
            
            .tab-content {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ Kalite Kontrol ve Paketleme Sistemi</h1>
            <p>√úr√ºn kalitesini takip edin, paketleme s√ºre√ßlerini y√∂netin</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('kalite-kontrol')">üìù Kalite Kontrol</div>
            <div class="tab" onclick="showTab('paketleme')">üì¶ Paketleme</div>
            <div class="tab" onclick="showTab('raporlar')">üìä Raporlar</div>
            <div class="tab" onclick="showTab('kayitlar')">üìã Kayƒ±tlar</div>
            <div class="tab" onclick="showTab('ayarlar')">‚öôÔ∏è Ayarlar</div>
        </div>

        <!-- Kalite Kontrol Tab -->
        <div id="kalite-kontrol" class="tab-content active">
            <h2>üîç Kalite Kontrol Formu</h2>
            <form id="kaliteForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tarih">üìÖ Tarih/Saat</label>
                        <input type="datetime-local" id="tarih" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="operator">üë§ Operat√∂r√ºn Adƒ±</label>
                        <select id="operator" required>
                            <option value="">Operat√∂r Se√ßin</option>
                            <option value="Ahmet Yƒ±lmaz">Ahmet Yƒ±lmaz</option>
                            <option value="Mehmet Demir">Mehmet Demir</option>
                            <option value="Ay≈üe Kaya">Ay≈üe Kaya</option>
                            <option value="Fatma √ñz">Fatma √ñz</option>
                            <option value="Ali √áelik">Ali √áelik</option>
                            <option value="Zeynep Arslan">Zeynep Arslan</option>
                            <option value="Mustafa ≈ûahin">Mustafa ≈ûahin</option>
                            <option value="Emine Doƒüan">Emine Doƒüan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="urunKodu">üì¶ √úr√ºn Kodu</label>
                        <input type="text" id="urunKodu" placeholder="√úr√ºn kodunu girin" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="siparisNo">üè∑Ô∏è Sipari≈ü Numarasƒ±</label>
                        <input type="text" id="siparisNo" placeholder="Sipari≈ü numarasƒ±nƒ± girin" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="geriGidenMiktar">‚Ü©Ô∏è Geri Giden √úr√ºn Miktarƒ±</label>
                        <input type="number" id="geriGidenMiktar" min="1" placeholder="Adet" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="iskartaMiktar">‚ùå Iskarta √úr√ºn Miktarƒ±</label>
                        <input type="number" id="iskartaMiktar" min="0" placeholder="Adet" value="0">
                    </div>
                </div>

                <div class="hata-container">
                    <h3>üö´ Tespit Edilen Hatalar ve Adetleri</h3>
                    <div class="hata-grid">
                        <div class="hata-item">
                            <input type="checkbox" id="hata1" name="hatalar" value="Aƒüƒ±z yamukluƒüu">
                            <label for="hata1">Aƒüƒ±z yamukluƒüu</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Aƒüƒ±z yamukluƒüu">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata2" name="hatalar" value="Yetersiz kaynak">
                            <label for="hata2">Yetersiz kaynak</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Yetersiz kaynak">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata3" name="hatalar" value="Fazla kaynak">
                            <label for="hata3">Fazla kaynak</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Fazla kaynak">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata4" name="hatalar" value="Bakƒ±r erimesi">
                            <label for="hata4">Kaynak esnasƒ±nda bakƒ±r erimesi</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Bakƒ±r erimesi">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata5" name="hatalar" value="Dƒ±≈üa kaynak akmasƒ±">
                            <label for="hata5">Dƒ±≈üa kaynak akmasƒ±</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Dƒ±≈üa kaynak akmasƒ±">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata6" name="hatalar" value="Boƒüum uzunluƒüu farklƒ±lƒ±ƒüƒ±">
                            <label for="hata6">Boƒüum uzunluƒüu farklƒ±lƒ±ƒüƒ±</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Boƒüum uzunluƒüu farklƒ±lƒ±ƒüƒ±">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata7" name="hatalar" value="Boƒüum yamukluƒüu">
                            <label for="hata7">Boƒüum yamukluƒüu</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Boƒüum yamukluƒüu">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata8" name="hatalar" value="√áizik √ºr√ºn">
                            <label for="hata8">√áizik √ºr√ºn</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="√áizik √ºr√ºn">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata9" name="hatalar" value="Temizlenememi≈ü √ºr√ºn">
                            <label for="hata9">Temizlenememi≈ü √ºr√ºn</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Temizlenememi≈ü √ºr√ºn">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata10" name="hatalar" value="Vuruk">
                            <label for="hata10">Vuruk</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Vuruk">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hata11" name="hatalar" value="Bilyeli √ºr√ºn">
                            <label for="hata11">Bilyeli √ºr√ºn</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Bilyeli √ºr√ºn">
                        </div>
                        
                        <div class="hata-item">
                            <input type="checkbox" id="hataDiger" name="hatalar" value="Diƒüer">
                            <label for="hataDiger">Diƒüer</label>
                            <input type="number" class="hata-adet" placeholder="Adet" min="0" data-hata="Diƒüer">
                        </div>
                    </div>
                    
                    <div class="diger-hata" id="digerHataDetay" style="display: none;">
                        <label for="digerAciklama"><strong>Diƒüer Hata A√ßƒ±klamasƒ±:</strong></label>
                        <input type="text" id="digerAciklama" placeholder="Hata detayƒ±nƒ± yazƒ±n...">
                    </div>
                </div>

                <button type="submit" class="btn">üíæ Kalite Kontrol Kaydƒ±nƒ± Kaydet</button>
            </form>
            <div id="kaliteAlert"></div>
        </div>

        <!-- Paketleme Tab -->
        <div id="paketleme" class="tab-content">
            <h2>üì¶ Paketleme ƒ∞≈ülemleri</h2>
            <form id="paketlemeForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="paketTarih">üìÖ Tarih/Saat</label>
                        <input type="datetime-local" id="paketTarih" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="paketOperator">üë§ Operat√∂r√ºn Adƒ±</label>
                        <select id="paketOperator" required>
                            <option value="">Operat√∂r Se√ßin</option>
                            <option value="Ahmet Yƒ±lmaz">Ahmet Yƒ±lmaz</option>
                            <option value="Mehmet Demir">Mehmet Demir</option>
                            <option value="Ay≈üe Kaya">Ay≈üe Kaya</option>
                            <option value="Fatma √ñz">Fatma √ñz</option>
                            <option value="Ali √áelik">Ali √áelik</option>
                            <option value="Zeynep Arslan">Zeynep Arslan</option>
                            <option value="Mustafa ≈ûahin">Mustafa ≈ûahin</option>
                            <option value="Emine Doƒüan">Emine Doƒüan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="paketUrunKodu">üì¶ √úr√ºn Kodu</label>
                        <input type="text" id="paketUrunKodu" placeholder="√úr√ºn kodunu girin" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="paketSiparisNo">üè∑Ô∏è Sipari≈ü Numarasƒ±</label>
                        <input type="text" id="paketSiparisNo" placeholder="Sipari≈ü numarasƒ±nƒ± girin" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="paketAdedi">üìä Paketlenen Adet</label>
                        <input type="number" id="paketAdedi" min="1" placeholder="Adet" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="paketTuru">üì¶ Paket T√ºr√º</label>
                        <select id="paketTuru" required>
                            <option value="">Paket t√ºr√º se√ßin</option>
                            <option value="Karton kutu">Karton kutu</option>
                            <option value="Plastik kasa">Plastik kasa</option>
                            <option value="Palet">Palet</option>
                            <option value="Shrink">Shrink</option>
                            <option value="Diƒüer">Diƒüer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="paketNotlar">üìù Notlar</label>
                        <input type="text" id="paketNotlar" placeholder="Ek notlar (opsiyonel)">
                    </div>
                </div>

                <button type="submit" class="btn btn-success">üì¶ Paketleme Kaydƒ±nƒ± Kaydet</button>
            </form>
            <div id="paketAlert"></div>
        </div>

        <!-- Raporlar Tab -->
        <div id="raporlar" class="tab-content">
            <h2>üìä Raporlar ve ƒ∞statistikler</h2>
            
            <div class="stats-grid" id="statsContainer">
                <div class="stat-card">
                    <h3 id="toplamKayit">0</h3>
                    <p>Toplam Kalite Kontrol Kaydƒ±</p>
                </div>
                <div class="stat-card">
                    <h3 id="toplamPaketleme">0</h3>
                    <p>Toplam Paketleme Kaydƒ±</p>
                </div>
                <div class="stat-card">
                    <h3 id="toplamGeriGiden">0</h3>
                    <p>Toplam Geri Giden √úr√ºn</p>
                </div>
                <div class="stat-card">
                    <h3 id="toplamIskarta">0</h3>
                    <p>Toplam Iskarta √úr√ºn</p>
                </div>
            </div>

            <div class="responsive-table">
                <h3>üìà Hata T√ºr√º Analizi</h3>
                <table id="hataAnalizi">
                    <thead>
                        <tr>
                            <th>Hata T√ºr√º</th>
                            <th>Toplam Adet</th>
                            <th>G√∂r√ºlme Sƒ±klƒ±ƒüƒ±</th>
                        </tr>
                    </thead>
                    <tbody id="hataAnaliziBody">
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 30px;">
                <button class="btn" onclick="exportToCSV('kalite')">üì• Kalite Verilerini CSV'ye Aktar</button>
                <button class="btn btn-success" onclick="exportToCSV('paketleme')">üì• Paketleme Verilerini CSV'ye Aktar</button>
            </div>
        </div>

        <!-- Kayƒ±tlar Tab -->
        <div id="kayitlar" class="tab-content">
            <h2>üìã T√ºm Kayƒ±tlar</h2>
            
            <div class="form-grid" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label for="kayitFiltre">üîç Kayƒ±t T√ºr√º Filtresi</label>
                    <select id="kayitFiltre" onchange="filterKayitlar()">
                        <option value="hepsi">T√ºm Kayƒ±tlar</option>
                        <option value="kalite">Kalite Kontrol</option>
                        <option value="paketleme">Paketleme</option>
                    </select>
                </div>
            </div>
            
            <div id="kayitlarContainer">
                <!-- Kayƒ±tlar buraya y√ºklenecek -->
            </div>
        </div>

        <!-- Ayarlar Tab -->
        <div id="ayarlar" class="tab-content">
            <h2>‚öôÔ∏è Sistem Ayarlarƒ±</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>üíæ Veri Yedekleme</label>
                    <button class="btn" onclick="exportAllData()">T√ºm Verileri Yedekle (JSON)</button>
                </div>
                
                <div class="form-group">
                    <label>üì§ Veri Geri Y√ºkleme</label>
                    <input type="file" id="importFile" accept=".json" onchange="importData()">
                </div>
                
                <div class="form-group">
                    <label>üóëÔ∏è Veri Temizleme</label>
                    <button class="btn btn-danger" onclick="clearAllData()">T√ºm Verileri Temizle</button>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3>üìä Sistem Bilgileri</h3>
                <p><strong>Toplam Veri Boyutu:</strong> <span id="dataSizeInfo">Hesaplanƒ±yor...</span></p>
                <p><strong>Son G√ºncelleme:</strong> <span id="lastUpdateInfo">-</span></p>
                <p><strong>Tarayƒ±cƒ± Depolama:</strong> <span id="storageInfo">Aktif</span></p>
            </div>
        </div>
    </div>

    <script>
        // Global deƒüi≈ükenler
        let kaliteKayitlari = JSON.parse(localStorage.getItem('kaliteKayitlari') || '[]');
        let paketlemeKayitlari = JSON.parse(localStorage.getItem('paketlemeKayitlari') || '[]');

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date().toISOString().slice(0, 16);
            document.getElementById('tarih').value = now;
            document.getElementById('paketTarih').value = now;
            
            loadStats();
            loadKayitlar();
            updateSystemInfo();
            
            // Diƒüer hata checkbox'ƒ± i√ßin listener
            document.getElementById('hataDiger').addEventListener('change', function() {
                const digerDetay = document.getElementById('digerHataDetay');
                digerDetay.style.display = this.checked ? 'block' : 'none';
            });

            // Hata checkbox'larƒ±na adet alanƒ± kontrol√º ekle
            document.querySelectorAll('.hata-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const adetInput = this.parentElement.querySelector('.hata-adet');
                    if (this.checked) {
                        adetInput.required = true;
                        adetInput.focus();
                    } else {
                        adetInput.required = false;
                        adetInput.value = '';
                    }
                });
            });
        });

        // Tab g√∂sterme fonksiyonu
        function showTab(tabName) {
            // T√ºm tab i√ßeriklerini gizle
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // T√ºm tab'lardan active class'ƒ±nƒ± kaldƒ±r
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Se√ßilen tab'ƒ± g√∂ster
            document.getElementById(tabName).classList.add('active');
            
            // Tƒ±klanan tab'a active class ekle
            event.target.classList.add('active');
            
            // Raporlar tab'ƒ± a√ßƒ±ldƒ±ƒüƒ±nda istatistikleri g√ºncelle
            if (tabName === 'raporlar') {
                loadStats();
            }
        }

        // Kalite kontrol form g√∂nderimi
        document.getElementById('kaliteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                tip: 'kalite',
                tarih: document.getElementById('tarih').value,
                operator: document.getElementById('operator').value,
                urunKodu: document.getElementById('urunKodu').value,
                siparisNo: document.getElementById('siparisNo').value,
                geriGidenMiktar: parseInt(document.getElementById('geriGidenMiktar').value),
                iskartaMiktar: parseInt(document.getElementById('iskartaMiktar').value),
                hatalar: []
            };

            // Se√ßili hatalarƒ± ve adetlerini topla
            document.querySelectorAll('.hata-item input[type="checkbox"]:checked').forEach(checkbox => {
                const adetInput = checkbox.parentElement.querySelector('.hata-adet');
                const adet = parseInt(adetInput.value) || 0;
                const hataAdi = checkbox.value;
                
                if (adet > 0) {
                    if (hataAdi === 'Diƒüer') {
                        const aciklama = document.getElementById('digerAciklama').value;
                        formData.hatalar.push({
                            tur: hataAdi + ': ' + aciklama,
                            adet: adet
                        });
                    } else {
                        formData.hatalar.push({
                            tur: hataAdi,
                            adet: adet
                        });
                    }
                }
            });

            // Kaydet
            kaliteKayitlari.push(formData);
            localStorage.setItem('kaliteKayitlari', JSON.stringify(kaliteKayitlari));

            // Form temizle
            document.getElementById('kaliteForm').reset();
            document.getElementById('tarih').value = new Date().toISOString().slice(0, 16);
            document.getElementById('digerHataDetay').style.display = 'none';
            document.querySelectorAll('.hata-adet').forEach(input => input.required = false);

            // Ba≈üarƒ± mesajƒ±
            showAlert('kaliteAlert', 'Kalite kontrol kaydƒ± ba≈üarƒ±yla kaydedildi!', 'success');
            
            loadStats();
            loadKayitlar();
        });

        // Paketleme form g√∂nderimi
        document.getElementById('paketlemeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                tip: 'paketleme',
                tarih: document.getElementById('paketTarih').value,
                operator: document.getElementById('paketOperator').value,
                urunKodu: document.getElementById('paketUrunKodu').value,
                siparisNo: document.getElementById('paketSiparisNo').value,
                paketAdedi: parseInt(document.getElementById('paketAdedi').value),
                paketTuru: document.getElementById('paketTuru').value,
                notlar: document.getElementById('paketNotlar').value
            };

            // Kaydet
            paketlemeKayitlari.push(formData);
            localStorage.setItem('paketlemeKayitlari', JSON.stringify(paketlemeKayitlari));

            // Form temizle
            document.getElementById('paketlemeForm').reset();
            document.getElementById('paketTarih').value = new Date().toISOString().slice(0, 16);

            // Ba≈üarƒ± mesajƒ±
            showAlert('paketAlert', 'Paketleme kaydƒ± ba≈üarƒ±yla kaydedildi!', 'success');
            
            loadStats();
            loadKayitlar();
        });

        // Alert g√∂sterme
        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type === 'success' ? 'success' : 'error'}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }

        // ƒ∞statistikleri y√ºkle
        function loadStats() {
            document.getElementById('toplamKayit').textContent = kaliteKayitlari.length;
            document.getElementById('toplamPaketleme').textContent = paketlemeKayitlari.length;
            
            const toplamGeriGiden = kaliteKayitlari.reduce((sum, kayit) => sum + kayit.geriGidenMiktar, 0);
            const toplamIskarta = kaliteKayitlari.reduce((sum, kayit) => sum + kayit.iskartaMiktar, 0);
            
            document.getElementById('toplamGeriGiden').textContent = toplamGeriGiden;
            document.getElementById('toplamIskarta').textContent = toplamIskarta;

            // Hata analizi tablosu
            loadHataAnalizi();
        }

        // Hata analizi tablosu
        function loadHataAnalizi() {
            const hataStats = {};
            
            kaliteKayitlari.forEach(kayit => {
                kayit.hatalar.forEach(hata => {
                    if (hataStats[hata.tur]) {
                        hataStats[hata.tur] += hata.adet;
                    } else {
                        hataStats[hata.tur] = hata.adet;
                    }
                });
            });

            const tbody = document.getElementById('hataAnaliziBody');
            tbody.innerHTML = '';

            const sortedHatalar = Object.entries(hataStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            sortedHatalar.forEach(([hata, adet]) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${hata}</td>
                    <td>${adet}</td>
                    <td>%${((adet / Object.values(hataStats).reduce((a, b) => a + b, 0)) * 100).toFixed(1)}</td>
                `;
            });
        }

        // Kayƒ±tlarƒ± y√ºkle
        function loadKayitlar() {
            const container = document.getElementById('kayitlarContainer');
            const allKayitlar = [...kaliteKayitlari, ...paketlemeKayitlari]
                .sort((a, b) => new Date(b.tarih) - new Date(a.tarih));

            container.innerHTML = '';

            allKayitlar.forEach(kayit => {
                const kayitDiv = document.createElement('div');
                kayitDiv.className = 'kayit-item';
                
                if (kayit.tip === 'kalite') {
                    kayitDiv.innerHTML = `
                        <div class="kayit-header">
                            <span>üîç Kalite Kontrol - ${new Date(kayit.tarih).toLocaleString('tr-TR')}</span>
                            <span style="color: #e74c3c;">${kayit.operator}</span>
                        </div>
                        <div class="kayit-details">
                            <div><strong>√úr√ºn Kodu:</strong> ${kayit.urunKodu}</div>
                            <div><strong>Sipari≈ü No:</strong> ${kayit.siparisNo}</div>
                            <div><strong>Geri Giden:</strong> ${kayit.geriGidenMiktar} adet</div>
                            <div><strong>Iskarta:</strong> ${kayit.iskartaMiktar} adet</div>
                            <div><strong>Hatalar:</strong> ${kayit.hatalar.map(h => `${h.tur} (${h.adet})`).join(', ')}</div>
                        </div>
                    `;
                } else {
                    kayitDiv.innerHTML = `
                        <div class="kayit-header">
                            <span>üì¶ Paketleme - ${new Date(kayit.tarih).toLocaleString('tr-TR')}</span>
                            <span style="color: #27ae60;">${kayit.operator}</span>
                        </div>
                        <div class="kayit-details">
                            <div><strong>√úr√ºn Kodu:</strong> ${kayit.urunKodu}</div>
                            <div><strong>Sipari≈ü No:</strong> ${kayit.siparisNo}</div>
                            <div><strong>Paketlenen:</strong> ${kayit.paketAdedi} adet</div>
                            <div><strong>Paket T√ºr√º:</strong> ${kayit.paketTuru}</div>
                            ${kayit.notlar ? `<div><strong>Notlar:</strong> ${kayit.notlar}</div>` : ''}
                        </div>
                    `;
                }
                
                container.appendChild(kayitDiv);
            });
        }

        // Kayƒ±t filtrele
        function filterKayitlar() {
            const filtre = document.getElementById('kayitFiltre').value;
            const container = document.getElementById('kayitlarContainer');
            
            let filteredKayitlar = [];
            
            if (filtre === 'hepsi') {
                filteredKayitlar = [...kaliteKayitlari, ...paketlemeKayitlari];
            } else if (filtre === 'kalite') {
                filteredKayitlar = kaliteKayitlari;
            } else if (filtre === 'paketleme') {
                filteredKayitlar = paketlemeKayitlari;
            }
            
            filteredKayitlar.sort((a, b) => new Date(b.tarih) - new Date(a.tarih));

            container.innerHTML = '';

            filteredKayitlar.forEach(kayit => {
                const kayitDiv = document.createElement('div');
                kayitDiv.className = 'kayit-item';
                
                if (kayit.tip === 'kalite') {
                    kayitDiv.innerHTML = `
                        <div class="kayit-header">
                            <span>üîç Kalite Kontrol - ${new Date(kayit.tarih).toLocaleString('tr-TR')}</span>
                            <span style="color: #e74c3c;">${kayit.operator}</span>
                        </div>
                        <div class="kayit-details">
                            <div><strong>√úr√ºn Kodu:</strong> ${kayit.urunKodu}</div>
                            <div><strong>Sipari≈ü No:</strong> ${kayit.siparisNo}</div>
                            <div><strong>Geri Giden:</strong> ${kayit.geriGidenMiktar} adet</div>
                            <div><strong>Iskarta:</strong> ${kayit.iskartaMiktar} adet</div>
                            <div><strong>Hatalar:</strong> ${kayit.hatalar.map(h => `${h.tur} (${h.adet})`).join(', ')}</div>
                        </div>
                    `;
                } else {
                    kayitDiv.innerHTML = `
                        <div class="kayit-header">
                            <span>üì¶ Paketleme - ${new Date(kayit.tarih).toLocaleString('tr-TR')}</span>
                            <span style="color: #27ae60;">${kayit.operator}</span>
                        </div>
                        <div class="kayit-details">
                            <div><strong>√úr√ºn Kodu:</strong> ${kayit.urunKodu}</div>
                            <div><strong>Sipari≈ü No:</strong> ${kayit.siparisNo}</div>
                            <div><strong>Paketlenen:</strong> ${kayit.paketAdedi} adet</div>
                            <div><strong>Paket T√ºr√º:</strong> ${kayit.paketTuru}</div>
                            ${kayit.notlar ? `<div><strong>Notlar:</strong> ${kayit.notlar}</div>` : ''}
                        </div>
                    `;
                }
                
                container.appendChild(kayitDiv);
            });
        }

        // CSV'ye aktar
        function exportToCSV(type) {
            let data = [];
            let filename = '';

            if (type === 'kalite') {
                data = kaliteKayitlari;
                filename = 'kalite_kontrol_verileri.csv';
            } else if (type === 'paketleme') {
                data = paketlemeKayitlari;
                filename = 'paketleme_verileri.csv';
            }

            if (data.length === 0) {
                alert('Aktarƒ±lacak veri bulunamadƒ±!');
                return;
            }

            let csv = '';

            if (type === 'kalite') {
                csv = 'Tarih,Operat√∂r,√úr√ºn Kodu,Sipari≈ü No,Geri Giden Miktar,Iskarta Miktar,Hatalar\n';
                data.forEach(kayit => {
                    const hatalarStr = kayit.hatalar.map(h => `${h.tur}(${h.adet})`).join(';');
                    csv += `"${kayit.tarih}","${kayit.operator}","${kayit.urunKodu}","${kayit.siparisNo}",${kayit.geriGidenMiktar},${kayit.iskartaMiktar},"${hatalarStr}"\n`;
                });
            } else {
                csv = 'Tarih,Operat√∂r,√úr√ºn Kodu,Sipari≈ü No,Paket Adedi,Paket T√ºr√º,Notlar\n';
                data.forEach(kayit => {
                    csv += `"${kayit.tarih}","${kayit.operator}","${kayit.urunKodu}","${kayit.siparisNo}",${kayit.paketAdedi},"${kayit.paketTuru}","${kayit.notlar || ''}"\n`;
                });
            }

            downloadCSV(csv, filename);
        }

        // CSV indirme
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // T√ºm verileri yedekle
        function exportAllData() {
            const allData = {
                kaliteKayitlari: kaliteKayitlari,
                paketlemeKayitlari: paketlemeKayitlari,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `kalite_kontrol_yedek_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
        }

        // Veri geri y√ºkle
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.kaliteKayitlari && data.paketlemeKayitlari) {
                        kaliteKayitlari = data.kaliteKayitlari;
                        paketlemeKayitlari = data.paketlemeKayitlari;
                        
                        localStorage.setItem('kaliteKayitlari', JSON.stringify(kaliteKayitlari));
                        localStorage.setItem('paketlemeKayitlari', JSON.stringify(paketlemeKayitlari));
                        
                        loadStats();
                        loadKayitlar();
                        updateSystemInfo();
                        
                        alert('Veriler ba≈üarƒ±yla geri y√ºklendi!');
                    } else {
                        alert('Ge√ßersiz dosya formatƒ±!');
                    }
                } catch (error) {
                    alert('Dosya okunamadƒ±: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // T√ºm verileri temizle
        function clearAllData() {
            if (confirm('T√ºm veriler silinecek! Bu i≈ülem geri alƒ±namaz. Emin misiniz?')) {
                localStorage.removeItem('kaliteKayitlari');
                localStorage.removeItem('paketlemeKayitlari');
                
                kaliteKayitlari = [];
                paketlemeKayitlari = [];
                
                loadStats();
                loadKayitlar();
                updateSystemInfo();
                
                alert('T√ºm veriler temizlendi!');
            }
        }

        // Sistem bilgilerini g√ºncelle
        function updateSystemInfo() {
            const dataSize = (JSON.stringify(kaliteKayitlari).length + JSON.stringify(paketlemeKayitlari).length) / 1024;
            document.getElementById('dataSizeInfo').textContent = dataSize.toFixed(2) + ' KB';
            
            const lastUpdate = kaliteKayitlari.length > 0 || paketlemeKayitlari.length > 0 
                ? new Date(Math.max(
                    ...kaliteKayitlari.map(k => new Date(k.tarih)),
                    ...paketlemeKayitlari.map(k => new Date(k.tarih))
                )).toLocaleString('tr-TR')
                : 'Hen√ºz kayƒ±t yok';
            
            document.getElementById('lastUpdateInfo').textContent = lastUpdate;
        }
    </script>
</body>
</html>
