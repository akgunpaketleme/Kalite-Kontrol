<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKG Takip Sistemi - Firebase</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: #333; 
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header { 
            background: linear-gradient(135deg, #2c3e50, #34495e); 
            color: white; 
            padding: 25px; 
            border-radius: 15px; 
            text-align: center; 
            margin-bottom: 30px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.2); 
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .header .status { font-size: 14px; color: #95a5a6; margin-top: 10px; }
        .header .status.connected { color: #2ecc71; }
        
        /* Modal Stilleri */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.7); 
            overflow-y: auto;
        }
        .modal.active { display: block; }
        .modal-content { 
            background: white; 
            margin: 50px auto; 
            padding: 30px; 
            border-radius: 15px; 
            max-width: 800px; 
            box-shadow: 0 10px 50px rgba(0,0,0,0.3); 
        }
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
            padding-bottom: 15px; 
            border-bottom: 2px solid #ecf0f1; 
        }
        .modal-header h2 { 
            color: #2c3e50; 
            font-size: 1.8em; 
        }
        .modal-close { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600; 
        }
        .modal-close:hover { background: #c0392b; }
        
        .tabs { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin-bottom: 25px; 
            justify-content: center; 
        }
        .tab { 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white; 
            border: none; 
            padding: 15px 25px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); 
        }
        .tab:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4); }
        .tab.active { background: linear-gradient(135deg, #e74c3c, #c0392b); box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4); }
        
        .tab-content { 
            display: none; 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
        }
        .tab-content.active { display: block; }
        .tab-content h2 { 
            color: #2c3e50; 
            margin-bottom: 25px; 
            font-size: 2em; 
            text-align: center; 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
        }
        
        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 25px; 
        }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: 600; margin-bottom: 8px; color: #2c3e50; font-size: 1.1em; }
        .form-group input, .form-group select, .form-group textarea { 
            padding: 12px; 
            border: 2px solid #bdc3c7; 
            border-radius: 8px; 
            font-size: 16px; 
            transition: all 0.3s ease; 
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            outline: none; 
            border-color: #3498db; 
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3); 
        }
        
        .btn { 
            background: linear-gradient(135deg, #27ae60, #2ecc71); 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3); 
            margin: 5px; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4); }
        .btn-success { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-edit { 
            background: linear-gradient(135deg, #f39c12, #e67e22); 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            transition: all 0.3s ease; 
        }
        .btn-delete { 
            background: linear-gradient(135deg, #e74c3c, #c0392b); 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            transition: all 0.3s ease; 
        }
        
        .alert { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: 600; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .kayit-item { 
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.1); 
        }
        .kayit-header { 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white; 
            padding: 12px 15px; 
            border-radius: 6px; 
            margin-bottom: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-weight: 600; 
        }
        .kayit-details { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            color: #2c3e50; 
        }
        
        /* GÃ¶rev (GÃ¼ncel Ä°ÅŸler) Stilleri */
        .gorev-item { 
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            padding: 15px; 
            margin-bottom: 10px; 
            cursor: move; 
            transition: all 0.3s ease; 
        }
        .gorev-item:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-color: #3498db; }
        .gorev-item.tamamlandi { opacity: 0.6; background: #f0f9f0; }
        .gorev-item.tamamlandi .gorev-baslik { text-decoration: line-through; }
        .gorev-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .gorev-baslik { font-weight: 600; font-size: 1.1em; color: #2c3e50; }
        .aciliyet-badge { 
            padding: 4px 12px; 
            border-radius: 15px; 
            font-size: 12px; 
            font-weight: bold; 
            color: white; 
        }
        .aciliyet-badge.acil { background: #e74c3c; }
        .aciliyet-badge.normal { background: #3498db; }
        .aciliyet-badge.dusuk { background: #95a5a6; }
        .gorev-not-item { 
            background: white; 
            padding: 8px; 
            margin: 5px 0; 
            border-radius: 4px; 
            border-left: 3px solid #3498db; 
        }
        
        /* SipariÅŸ Durumu Badge'leri */
        .durum-badge { 
            padding: 5px 12px; 
            border-radius: 15px; 
            font-size: 13px; 
            font-weight: bold; 
            color: white; 
            display: inline-block; 
        }
        .durum-badge.bekleniyor { background: #f39c12; }
        .durum-badge.geldi { background: #27ae60; }
        .durum-badge.iptal { background: #95a5a6; }
        
        /* Stok YÃ¶netimi Stilleri */
        .stok-kayit-item { 
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            transition: all 0.3s ease; 
        }
        .stok-kayit-item:hover { border-color: #3498db; box-shadow: 0 6px 20px rgba(52, 152, 219, 0.2); }
        .stok-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 2px solid #ecf0f1; 
        }
        .stok-bilgi { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        .stok-bilgi-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px; 
            background: #f8f9fa; 
            border-radius: 6px; 
            border-left: 4px solid #3498db; 
        }
        .stok-kontrol { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 15px; 
            padding: 15px; 
            background: #ecf0f1; 
            border-radius: 8px; 
        }
        .stok-adet-display { 
            background: white; 
            padding: 8px 15px; 
            border: 2px solid #3498db; 
            border-radius: 6px; 
            font-weight: bold; 
            font-size: 1.2em; 
            color: #2c3e50; 
            min-width: 60px; 
            text-align: center; 
        }
        .stok-adet-input { 
            width: 100px; 
            padding: 8px; 
            text-align: center; 
            border: 2px solid #3498db; 
            border-radius: 6px; 
            font-weight: bold; 
        }

        /* Malzeme Checkbox Stilleri */
        .malzeme-checklist {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .malzeme-checklist label {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
            user-select: none;
        }
        .malzeme-checklist input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            cursor: pointer;
            transform: scale(1.2);
        }
        .malzeme-checklist input[type="checkbox"]:checked {
            accent-color: #27ae60;
        }
        
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .tab { width: 100%; margin-bottom: 5px; }
            .stok-bilgi { grid-template-columns: 1fr; }
            .malzeme-checklist label {
                display: flex;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ AKG Takip Sistemi</h1>
            <div class="status" id="connectionStatus">ğŸ”„ BaÄŸlanÄ±yor...</div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('guncel-isler')">ğŸ“‹ GÃ¼ncel Ä°ÅŸler</button>
            <button class="tab" onclick="showTab('siparis-hazirlik')">ğŸ“¦ SipariÅŸ HazÄ±rlÄ±ÄŸÄ±</button>
            <button class="tab" onclick="showTab('siparisler')">ğŸ›’ SipariÅŸler</button>
            <button class="tab" onclick="showTab('stok')">ğŸ“Š Stok YÃ¶netimi</button>
            <button class="tab" onclick="showTab('veri-aktar')" style="background: linear-gradient(135deg, #e67e22, #d35400);">ğŸ”„ Veri Aktar</button>
        </div>

        <!-- GÃ¼ncel Ä°ÅŸler Tab -->
        <div id="guncel-isler" class="tab-content active">
            <h2>ğŸ“‹ GÃ¼ncel Ä°ÅŸler</h2>
            
            <form id="gorevEkleForm">
                <h3>â• Yeni GÃ¶rev Ekle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="gorevBaslik">ğŸ“ GÃ¶rev BaÅŸlÄ±ÄŸÄ±</label>
                        <input type="text" id="gorevBaslik" placeholder="GÃ¶rev baÅŸlÄ±ÄŸÄ±nÄ± girin" required>
                    </div>
                    <div class="form-group">
                        <label for="gorevAciliyet">âš ï¸ Aciliyet</label>
                        <select id="gorevAciliyet" required>
                            <option value="acil">ğŸ”´ Acil</option>
                            <option value="normal" selected>ğŸ”µ Normal</option>
                            <option value="dusuk">âšª DÃ¼ÅŸÃ¼k</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gorevAtanan">ğŸ‘¤ Atanan KiÅŸi</label>
                        <select id="gorevAtanan">
                            <option value="">Herkes</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gorevAciklama">ğŸ“„ AÃ§Ä±klama</label>
                        <textarea id="gorevAciklama" rows="3" placeholder="GÃ¶rev detaylarÄ±..."></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">â• GÃ¶rev Ekle</button>
            </form>
            <div id="gorevAlert"></div>

            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="siralaGorevler('aciliyet')">âš ï¸ Aciliyete GÃ¶re SÄ±rala</button>
                <button class="btn" onclick="siralaGorevler('tarih')">ğŸ“… Tarihe GÃ¶re SÄ±rala</button>
                <button class="btn btn-danger" onclick="tamamlananGizle()">ğŸ‘ï¸ TamamlananlarÄ± Gizle/GÃ¶ster</button>
            </div>

            <div id="gorevlerListesi"></div>
        </div>

        <!-- SipariÅŸ HazÄ±rlÄ±ÄŸÄ± Tab -->
        <div id="siparis-hazirlik" class="tab-content">
            <h2>ğŸ“¦ SipariÅŸ HazÄ±rlÄ±ÄŸÄ±</h2>
            
            <form id="siparisEkleForm">
                <h3>â• Yeni SipariÅŸ Ekle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="hazirlikTarih">ğŸ“… Tarih</label>
                        <input type="date" id="hazirlikTarih" required>
                    </div>
                    <div class="form-group">
                        <label for="hazirlikOperator">ğŸ‘¤ OperatÃ¶r</label>
                        <select id="hazirlikOperator" required>
                            <option value="">OperatÃ¶r seÃ§in</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hazirlikSiparisNo">ğŸ”¢ SipariÅŸ No</label>
                        <input type="text" id="hazirlikSiparisNo" placeholder="SipariÅŸ numarasÄ±" required>
                    </div>
                    <div class="form-group">
                        <label for="urunKoduSiparis">ğŸ“¦ ÃœrÃ¼n Kodu</label>
                        <input type="text" id="urunKoduSiparis" placeholder="ÃœrÃ¼n kodu" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisAdet">ğŸ“Š SipariÅŸ Adedi</label>
                        <input type="number" id="siparisAdet" min="1" placeholder="Toplam adet" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisNotlar">ğŸ“ Notlar</label>
                        <textarea id="siparisNotlar" rows="3" placeholder="SipariÅŸ notlarÄ±..."></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">â• SipariÅŸ Ekle</button>
            </form>
            <div id="siparisEkleAlert"></div>

            <!-- SipariÅŸ HazÄ±rlÄ±k Ã–zeti -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 25px 0; border: 2px solid #e9ecef;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center; background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px; border-radius: 8px;">ğŸ“Š SipariÅŸ HazÄ±rlÄ±k Ã–zeti</h3>
                <div id="siparisHazirlikOzeti"></div>
            </div>

            <div id="siparislerContainer">
                <h3>ğŸ“‹ Mevcut SipariÅŸler</h3>
                <div id="siparislerListesi"></div>
            </div>
        </div>

        <!-- ÃœrÃ¼n SipariÅŸleri Tab -->
        <div id="siparisler" class="tab-content">
            <h2>ğŸ›’ ÃœrÃ¼n SipariÅŸleri</h2>
            
            <form id="urunSiparisForm">
                <h3>â• Yeni ÃœrÃ¼n SipariÅŸi</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="siparisUrunAdi">ğŸ“¦ ÃœrÃ¼n AdÄ±</label>
                        <input type="text" id="siparisUrunAdi" placeholder="ÃœrÃ¼n adÄ±" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisAdetMiktar">ğŸ“Š Adet / Miktar</label>
                        <input type="text" id="siparisAdetMiktar" placeholder="Ã–rn: 100 adet" required>
                    </div>
                    <div class="form-group">
                        <label for="siparisOlcu">ğŸ“ Ã–lÃ§Ã¼</label>
                        <input type="text" id="siparisOlcu" placeholder="Ã–rn: 25x15 cm">
                    </div>
                    <div class="form-group">
                        <label for="siparisAciklama">ğŸ“ AÃ§Ä±klama / Not</label>
                        <textarea id="siparisAciklama" rows="3" placeholder="SipariÅŸ detaylarÄ±..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="siparisTalipEden">ğŸ‘¤ Talep Eden</label>
                        <select id="siparisTalipEden" required>
                            <option value="">KiÅŸi seÃ§in</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">â• SipariÅŸ Ekle</button>
            </form>
            <div id="siparisAlert"></div>

            <!-- SipariÅŸ Ã–zeti -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 25px 0; border: 2px solid #e9ecef;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center; background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px; border-radius: 8px;">ğŸ“Š SipariÅŸ Ã–zeti</h3>
                <div id="urunSiparisOzeti"></div>
            </div>

            <div style="margin: 20px 0;">
                <label style="font-weight: 600; margin-right: 10px;">Filtre:</label>
                <button class="btn" onclick="filtreSiparisler('hepsi')">TÃ¼mÃ¼</button>
                <button class="btn btn-success" onclick="filtreSiparisler('bekleniyor')">Bekleniyor</button>
                <button class="btn btn-success" onclick="filtreSiparisler('geldi')">Geldi</button>
                <button class="btn btn-danger" onclick="filtreSiparisler('iptal')">Ä°ptal</button>
            </div>

            <div id="urunSiparislerListesi"></div>
        </div>

        <!-- Stok YÃ¶netimi Tab -->
        <div id="stok" class="tab-content">
            <h2>ğŸ“Š Stok YÃ¶netimi</h2>
            
            <form id="stokForm">
                <h3>â• Stok Ekle/GÃ¼ncelle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="stokMalzemeTuru">ğŸ”§ Malzeme TÃ¼rÃ¼</label>
                        <select id="stokMalzemeTuru" required>
                            <option value="">Malzeme tÃ¼rÃ¼nÃ¼ seÃ§in</option>
                            <option value="izolasyon">Ä°zolasyon</option>
                            <option value="koli">Koli</option>
                            <option value="kutu">Kutu</option>
                            <option value="poset">PoÅŸet</option>
                            <option value="tapa">Tapa</option>
                            <option value="etiket">Etiket</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stokUrunAdi">ğŸ“¦ ÃœrÃ¼n AdÄ±</label>
                        <input type="text" id="stokUrunAdi" placeholder="ÃœrÃ¼n adÄ±nÄ± yazÄ±n" required>
                    </div>
                    <div class="form-group">
                        <label for="stokOlculeri">ğŸ“ Ã–lÃ§Ã¼ler (Ä°steÄŸe BaÄŸlÄ±)</label>
                        <input type="text" id="stokOlculeri" placeholder="Ã–rn: 25x15x10 cm">
                    </div>
                    <div class="form-group">
                        <label for="stokMevcut">ğŸ“Š Mevcut Adet</label>
                        <input type="number" id="stokMevcut" placeholder="Mevcut adet" required>
                    </div>
                    <div class="form-group">
                        <label for="stokEkleyen">ğŸ‘¤ Verileri Ekleyen</label>
                        <select id="stokEkleyen" required>
                            <option value="">KiÅŸi seÃ§in</option>
                            <option value="Esat">Esat</option>
                            <option value="Ahmet">Ahmet</option>
                            <option value="Emre">Emre</option>
                            <option value="GÃ¶kay">GÃ¶kay</option>
                            <option value="Berke">Berke</option>
                            <option value="Melisa">Melisa</option>
                            <option value="Evrim">Evrim</option>
                            <option value="Koray">Koray</option>
                        </select>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn">ğŸ’¾ Stok Kaydet</button>
                    <button type="button" class="btn btn-success" onclick="temizleStokFormu()">ğŸ§¹ Formu Temizle</button>
                </div>
            </form>
            <div id="stokAlert"></div>

            <!-- Stok Ã–zeti -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 25px 0; border: 2px solid #e9ecef;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 12px; border-radius: 8px;">ğŸ“¦ TÃ¼m Stoklar Ã–zeti</h3>
                <div id="stokOzeti"></div>
            </div>

            <div id="stokListesiContainer">
                <h3>ğŸ“‹ DetaylÄ± Stok Listesi</h3>
                <div id="stokListesi"></div>
            </div>
        </div>

        <!-- Veri Aktar Tab -->
        <div id="veri-aktar" class="tab-content">
            <h2>ğŸ”„ Veri Aktarma</h2>
            
            <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                <h3 style="color: #856404; margin-bottom: 15px;">âš ï¸ Ã–nemli Bilgilendirme</h3>
                <p style="color: #856404; line-height: 1.6;">
                    Bu araÃ§, eski sisteminizden (LocalStorage) verileri Firebase'e aktarmanÄ±z iÃ§in kullanÄ±lÄ±r.<br>
                    <strong>Not:</strong> Veri aktarÄ±mÄ± mevcut Firebase verilerinin Ã¼zerine EKLER, silmez.
                </p>
            </div>

            <div class="kayit-item">
                <div class="kayit-header">
                    <div><strong>ğŸ“¤ AdÄ±m 1: Eski Sistemden Veri Ã‡Ä±karma</strong></div>
                </div>
                <div style="padding: 20px;">
                    <ol style="line-height: 2;">
                        <li><strong>Eski HTML dosyanÄ±zÄ±</strong> tarayÄ±cÄ±da aÃ§Ä±n (verilerinizin kayÄ±tlÄ± olduÄŸu dosya)</li>
                        <li>AynÄ± tarayÄ±cÄ± penceresinde <strong>yeni bir sekme</strong> aÃ§Ä±n</li>
                        <li>Yeni sekmede <strong>"veri-cikarma-araci.html"</strong> dosyasÄ±nÄ± aÃ§Ä±n</li>
                        <li><strong>"Verileri Kontrol Et"</strong> butonuna tÄ±klayÄ±n</li>
                        <li>Verilerinizi <strong>JSON dosyasÄ± olarak</strong> indirin</li>
                    </ol>
                    <a href="veri-cikarma-araci.html" target="_blank" class="btn" style="display: inline-block; text-decoration: none; margin-top: 10px;">
                        ğŸ”— Veri Ã‡Ä±karma AracÄ±nÄ± AÃ§
                    </a>
                </div>
            </div>

            <div class="kayit-item">
                <div class="kayit-header">
                    <div><strong>ğŸ“¥ AdÄ±m 2: Firebase'e Veri YÃ¼kleme</strong></div>
                </div>
                <div style="padding: 20px;">
                    <p style="margin-bottom: 15px;">Ä°ndirdiÄŸiniz JSON dosyasÄ±nÄ± buradan yÃ¼kleyin:</p>
                    <input type="file" id="importFile" accept=".json" style="padding: 10px; border: 2px solid #3498db; border-radius: 8px; width: 100%; margin-bottom: 15px;">
                    <button class="btn btn-success" onclick="verileriYukle()">ğŸ“¤ Verileri Firebase'e Aktar</button>
                </div>
            </div>

            <div id="importStatus"></div>

            <div class="kayit-item" style="margin-top: 30px;">
                <div class="kayit-header" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                    <div><strong>ğŸ“¥ JSON Veri Ä°ndirme</strong></div>
                </div>
                <div style="padding: 20px;">
                    <p style="margin-bottom: 15px;">TÃ¼m Firebase verilerinizi JSON dosyasÄ± olarak bilgisayarÄ±nÄ±za indirin (yedek amaÃ§lÄ±).</p>
                    <button class="btn btn-success" onclick="firebaseVerileriniIndir()">ğŸ“¥ TÃ¼m Verileri JSON Olarak Ä°ndir</button>
                </div>
            </div>

            <div class="kayit-item" style="margin-top: 30px;">
                <div class="kayit-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                    <div><strong>ğŸ—‘ï¸ Tehlikeli Alan: TÃ¼m Firebase Verilerini Sil</strong></div>
                </div>
                <div style="padding: 20px;">
                    <p style="color: #721c24; margin-bottom: 15px; font-weight: 600;">
                        âš ï¸ Bu iÅŸlem Firebase'deki TÃœM verileri kalÄ±cÄ± olarak siler. Bu iÅŸlem geri alÄ±namaz!
                    </p>
                    <button class="btn btn-danger" onclick="tumFirebaseVerileriniSil()">ğŸ—‘ï¸ TÃ¼m Firebase Verilerini Sil</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DÃ¼zenleme Modal'Ä± -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">âœï¸ DÃ¼zenle</h2>
                <button class="modal-close" onclick="closeEditModal()">âœ– Kapat</button>
            </div>
            <div id="editFormContainer"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDJYEEnWdlfzCVFg-w_IIWE5QbNFzN9hqA",
            authDomain: "akgkalitekontrol.firebaseapp.com",
            databaseURL: "https://akgkalitekontrol-default-rtdb.firebaseio.com",
            projectId: "akgkalitekontrol",
            storageBucket: "akgkalitekontrol.firebasestorage.app",
            messagingSenderId: "315960243910",
            appId: "1:315960243910:web:bb97b559d7d6648e5fc9c7",
            measurementId: "G-BX4HH38KHE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Connection Status
        const connectedRef = database.ref('.info/connected');
        connectedRef.on('value', (snap) => {
            const statusEl = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                statusEl.textContent = 'âœ… BaÄŸlÄ± - Realtime Database Aktif';
                statusEl.className = 'status connected';
            } else {
                statusEl.textContent = 'âŒ BaÄŸlantÄ± Kesildi';
                statusEl.className = 'status';
            }
        });

        // Global deÄŸiÅŸkenler
        let tamamlananlariGoster = true;
        let currentSiparisFilter = 'hepsi';

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().slice(0, 10);
            document.getElementById('hazirlikTarih').value = today;

            // Firebase listeners
            listenToGorevler();
            listenToSiparisHazirlik();
            listenToUrunSiparisler();
            listenToStok();

            // Form listeners
            document.getElementById('gorevEkleForm').addEventListener('submit', gorevEkle);
            document.getElementById('siparisEkleForm').addEventListener('submit', siparisEkle);
            document.getElementById('urunSiparisForm').addEventListener('submit', urunSiparisEkle);
            document.getElementById('stokForm').addEventListener('submit', stokEkleGuncelle);
        });

        // ==================== GÃœNCEL Ä°ÅLER ====================
        function listenToGorevler() {
            database.ref('gorevler').on('value', (snapshot) => {
                const gorevler = [];
                snapshot.forEach((childSnapshot) => {
                    gorevler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadGorevlerListesi(gorevler);
            });
        }

        function gorevEkle(e) {
            e.preventDefault();
            
            const gorevData = {
                baslik: document.getElementById('gorevBaslik').value.trim(),
                aciliyet: document.getElementById('gorevAciliyet').value,
                atanan: document.getElementById('gorevAtanan').value,
                aciklama: document.getElementById('gorevAciklama').value.trim(),
                tamamlandi: false,
                notlar: [],
                olusturmaTarihi: new Date().toISOString(),
                sira: Date.now()
            };

            database.ref('gorevler').push(gorevData)
                .then(() => {
                    document.getElementById('gorevEkleForm').reset();
                    showAlert('gorevAlert', 'GÃ¶rev baÅŸarÄ±yla eklendi!', 'success');
                })
                .catch((error) => {
                    showAlert('gorevAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function loadGorevlerListesi(gorevler) {
            const container = document.getElementById('gorevlerListesi');
            if (!container) return;

            let filtrelenmisGorevler = gorevler;
            if (!tamamlananlariGoster) {
                filtrelenmisGorevler = gorevler.filter(g => !g.tamamlandi);
            }

            if (filtrelenmisGorevler.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z gÃ¶rev bulunmuyor.</p>';
                return;
            }

            let html = '<div style="margin-top: 20px;">';
            filtrelenmisGorevler.forEach(gorev => {
                const aciliyetClass = gorev.aciliyet === 'acil' ? 'acil' : gorev.aciliyet === 'normal' ? 'normal' : 'dusuk';
                const aciliyetText = gorev.aciliyet === 'acil' ? 'ğŸ”´ Acil' : gorev.aciliyet === 'normal' ? 'ğŸ”µ Normal' : 'âšª DÃ¼ÅŸÃ¼k';
                
                html += `
                    <div class="gorev-item ${gorev.tamamlandi ? 'tamamlandi' : ''}">
                        <div class="gorev-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" ${gorev.tamamlandi ? 'checked' : ''} onchange="toggleGorevTamamlandi('${gorev.id}')" style="transform: scale(1.3);">
                                <div class="gorev-baslik">${gorev.baslik}</div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="aciliyet-badge ${aciliyetClass}">${aciliyetText}</span>
                                ${gorev.atanan ? `<span style="background: #3498db; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px;">ğŸ‘¤ ${gorev.atanan}</span>` : ''}
                                <button class="btn-edit" onclick="gorevDuzenle('${gorev.id}')">âœï¸</button>
                                <button class="btn-delete" onclick="gorevSil('${gorev.id}')" style="padding: 5px 10px;">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        ${gorev.aciklama ? `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 14px;">${gorev.aciklama}</div>` : ''}
                        
                        <div style="margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;">
                            <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <input type="text" id="not-input-${gorev.id}" placeholder="Not ekle..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                                <button class="btn" onclick="gorevNotEkle('${gorev.id}')" style="padding: 8px 15px; font-size: 13px;">â• Not</button>
                            </div>
                            ${gorev.notlar && gorev.notlar.length > 0 ? `
                                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-top: 10px;">
                                    ${gorev.notlar.map((not, index) => `
                                        <div class="gorev-not-item">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <div style="flex: 1;">
                                                    <strong style="font-size: 12px; color: #3498db;">${not.ekleyen} - ${new Date(not.tarih).toLocaleString('tr-TR')}</strong>
                                                    <div>${not.metin}</div>
                                                </div>
                                                <button onclick="gorevNotSil('${gorev.id}', ${index})" style="background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 16px;">âŒ</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function toggleGorevTamamlandi(id) {
            database.ref('gorevler/' + id).once('value').then((snapshot) => {
                const gorev = snapshot.val();
                database.ref('gorevler/' + id).update({
                    tamamlandi: !gorev.tamamlandi
                });
            });
        }

        function gorevNotEkle(id) {
            const input = document.getElementById(`not-input-${id}`);
            const notMetin = input.value.trim();
            if (!notMetin) return;

            database.ref('gorevler/' + id + '/notlar').once('value').then((snapshot) => {
                const notlar = snapshot.val() || [];
                notlar.push({
                    metin: notMetin,
                    ekleyen: 'KullanÄ±cÄ±',
                    tarih: new Date().toISOString()
                });
                database.ref('gorevler/' + id).update({ notlar });
                input.value = '';
            });
        }

        function gorevNotSil(gorevId, notIndex) {
            database.ref('gorevler/' + gorevId + '/notlar').once('value').then((snapshot) => {
                const notlar = snapshot.val() || [];
                notlar.splice(notIndex, 1);
                database.ref('gorevler/' + gorevId).update({ notlar });
            });
        }

        function gorevSil(id) {
            if (confirm('Bu gÃ¶revi silmek istediÄŸinizden emin misiniz?')) {
                database.ref('gorevler/' + id).remove()
                    .then(() => showAlert('gorevAlert', 'GÃ¶rev silindi!', 'success'))
                    .catch((error) => showAlert('gorevAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        function siralaGorevler(tip) {
            database.ref('gorevler').once('value').then((snapshot) => {
                const gorevler = [];
                snapshot.forEach((childSnapshot) => {
                    gorevler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });

                if (tip === 'aciliyet') {
                    const aciliyetSirasi = { 'acil': 1, 'normal': 2, 'dusuk': 3 };
                    gorevler.sort((a, b) => aciliyetSirasi[a.aciliyet] - aciliyetSirasi[b.aciliyet]);
                } else if (tip === 'tarih') {
                    gorevler.sort((a, b) => new Date(b.olusturmaTarihi) - new Date(a.olusturmaTarihi));
                }

                loadGorevlerListesi(gorevler);
            });
        }

        function tamamlananGizle() {
            tamamlananlariGoster = !tamamlananlariGoster;
            listenToGorevler();
        }

        // ==================== SÄ°PARÄ°Å HAZIRLIK ====================
        function listenToSiparisHazirlik() {
            database.ref('siparisHazirlik').on('value', (snapshot) => {
                const siparisler = [];
                snapshot.forEach((childSnapshot) => {
                    siparisler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadSiparislerListesi(siparisler);
            });
        }

        function siparisEkle(e) {
            e.preventDefault();
            
            const siparisData = {
                tarih: document.getElementById('hazirlikTarih').value,
                operator: document.getElementById('hazirlikOperator').value,
                siparisNo: document.getElementById('hazirlikSiparisNo').value.trim(),
                urunKodu: document.getElementById('urunKoduSiparis').value.trim(),
                siparisAdet: parseInt(document.getElementById('siparisAdet').value),
                notlar: document.getElementById('siparisNotlar').value.trim(),
                durum: 'beklemede',
                olusturmaTarihi: new Date().toISOString(),
                malzemeChecklist: {
                    koli: false,
                    kutu: false,
                    izolasyon: false,
                    tapa: false,
                    poset: false
                }
            };

            database.ref('siparisHazirlik').push(siparisData)
                .then(() => {
                    document.getElementById('siparisEkleForm').reset();
                    const today = new Date().toISOString().slice(0, 10);
                    document.getElementById('hazirlikTarih').value = today;
                    showAlert('siparisEkleAlert', 'SipariÅŸ baÅŸarÄ±yla eklendi!', 'success');
                })
                .catch((error) => {
                    showAlert('siparisEkleAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function loadSiparislerListesi(siparisler) {
            const container = document.getElementById('siparislerListesi');
            if (!container) return;

            // Ã–zet gÃ¼ncelle
            guncelleSiparisHazirlikOzeti(siparisler);

            if (siparisler.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z sipariÅŸ bulunmuyor.</p>';
                return;
            }

            let html = '';
            siparisler.slice().reverse().forEach(siparis => {
                const gonderilenAdet = siparis.gonderilenAdet || 0;
                const kalanAdet = siparis.siparisAdet - gonderilenAdet;
                
                // Malzeme checklist verilerini al (eski kayÄ±tlar iÃ§in default false)
                const checklist = siparis.malzemeChecklist || {
                    koli: false,
                    kutu: false,
                    izolasyon: false,
                    tapa: false,
                    poset: false
                };
                
                html += `
                    <div class="kayit-item">
                        <div class="kayit-header">
                            <div><strong>ğŸ”¢ ${siparis.siparisNo} - ğŸ“¦ ${siparis.urunKodu}</strong></div>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn-edit" onclick="siparisHazirlikDuzenle('${siparis.id}')">âœï¸</button>
                                <button class="btn-delete" onclick="siparisSil('${siparis.id}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <div class="kayit-details">
                            <div><strong>ğŸ“… Tarih:</strong> ${new Date(siparis.tarih).toLocaleDateString('tr-TR')}</div>
                            <div><strong>ğŸ‘¤ OperatÃ¶r:</strong> ${siparis.operator}</div>
                            <div><strong>ğŸ“Š SipariÅŸ Adedi:</strong> ${siparis.siparisAdet}</div>
                            <div><strong>ğŸ“¤ GÃ¶nderilen:</strong> <span style="color: #27ae60; font-weight: bold;">${gonderilenAdet}</span></div>
                            <div><strong>ğŸ“‰ Kalan:</strong> <span style="color: ${kalanAdet > 0 ? '#e74c3c' : '#27ae60'}; font-weight: bold;">${kalanAdet}</span></div>
                            <div><strong>ğŸ“Š Durum:</strong> ${siparis.durum === 'tamamlandi' ? 'âœ… TamamlandÄ±' : 'â³ Beklemede'}</div>
                            ${siparis.notlar ? `<div style="grid-column: 1/-1;"><strong>ğŸ“ Notlar:</strong> ${siparis.notlar}</div>` : ''}
                        </div>
                        
                        <!-- Malzeme Checklist -->
                        <div class="malzeme-checklist">
                            <label>
                                <input type="checkbox" ${checklist.koli ? 'checked' : ''} onchange="toggleMalzeme('${siparis.id}', 'koli', this.checked)">
                                ğŸ“¦ Koli
                            </label>
                            <label>
                                <input type="checkbox" ${checklist.kutu ? 'checked' : ''} onchange="toggleMalzeme('${siparis.id}', 'kutu', this.checked)">
                                ğŸ“¦ Kutu
                            </label>
                            <label>
                                <input type="checkbox" ${checklist.izolasyon ? 'checked' : ''} onchange="toggleMalzeme('${siparis.id}', 'izolasyon', this.checked)">
                                ğŸ§Š Ä°zolasyon
                            </label>
                            <label>
                                <input type="checkbox" ${checklist.tapa ? 'checked' : ''} onchange="toggleMalzeme('${siparis.id}', 'tapa', this.checked)">
                                ğŸ”˜ Tapa
                            </label>
                            <label>
                                <input type="checkbox" ${checklist.poset ? 'checked' : ''} onchange="toggleMalzeme('${siparis.id}', 'poset', this.checked)">
                                ğŸ›ï¸ PoÅŸet
                            </label>
                        </div>
                        
                        <!-- GÃ¶nderilen Adet Ekleme -->
                        <div style="margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px; border: 2px solid #27ae60;">
                            <label style="font-weight: 600; display: block; margin-bottom: 8px; color: #27ae60;">ğŸ“¤ GÃ¶nderilen Adet Ekle</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="number" 
                                       id="gonderilen-${siparis.id}" 
                                       placeholder="GÃ¶nderilen adet" 
                                       min="1" 
                                       max="${kalanAdet}"
                                       style="flex: 1; padding: 10px; border: 2px solid #27ae60; border-radius: 6px; font-weight: bold;">
                                <button class="btn btn-success" 
                                        onclick="gonderilenAdetEkle('${siparis.id}')" 
                                        style="padding: 10px 20px; white-space: nowrap;">
                                    â• Ekle
                                </button>
                            </div>
                            ${kalanAdet <= 0 ? '<div style="margin-top: 8px; color: #27ae60; font-weight: 600;">âœ… SipariÅŸ tamamen gÃ¶nderildi!</div>' : ''}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function toggleMalzeme(siparisId, malzeme, checked) {
            database.ref('siparisHazirlik/' + siparisId + '/malzemeChecklist/' + malzeme).set(checked)
                .then(() => {
                    console.log(`${malzeme} durumu gÃ¼ncellendi: ${checked}`);
                })
                .catch((error) => {
                    console.error('Malzeme durumu gÃ¼ncellenemedi:', error);
                    showAlert('siparisEkleAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function guncelleSiparisHazirlikOzeti(siparisler) {
            const container = document.getElementById('siparisHazirlikOzeti');
            if (!container) return;

            const beklemede = siparisler.filter(s => s.durum === 'beklemede').length;
            const tamamlandi = siparisler.filter(s => s.durum === 'tamamlandi').length;
            
            const toplamSiparisAdet = siparisler.reduce((sum, s) => sum + (s.siparisAdet || 0), 0);
            const toplamGonderilen = siparisler.reduce((sum, s) => sum + (s.gonderilenAdet || 0), 0);
            const toplamKalan = toplamSiparisAdet - toplamGonderilen;

            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #f39c12;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #f39c12;">${beklemede}</div>
                        <div style="color: #666; margin-top: 5px;">â³ Beklemede</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #27ae60;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #27ae60;">${tamamlandi}</div>
                        <div style="color: #666; margin-top: 5px;">âœ… TamamlandÄ±</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #3498db;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #3498db;">${toplamSiparisAdet}</div>
                        <div style="color: #666; margin-top: 5px;">ğŸ“¦ Toplam SipariÅŸ</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #27ae60;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #27ae60;">${toplamGonderilen}</div>
                        <div style="color: #666; margin-top: 5px;">ğŸ“¤ GÃ¶nderilen</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #e74c3c;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #e74c3c;">${toplamKalan}</div>
                        <div style="color: #666; margin-top: 5px;">ğŸ“‰ Kalan</div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function gonderilenAdetEkle(id) {
            const input = document.getElementById(`gonderilen-${id}`);
            const eklenecekAdet = parseInt(input.value);
            
            if (isNaN(eklenecekAdet) || eklenecekAdet <= 0) {
                alert('LÃ¼tfen geÃ§erli bir adet giriniz!');
                return;
            }

            database.ref('siparisHazirlik/' + id).once('value').then((snapshot) => {
                const siparis = snapshot.val();
                const mevcutGonderilen = siparis.gonderilenAdet || 0;
                const yeniGonderilen = mevcutGonderilen + eklenecekAdet;
                const kalanAdet = siparis.siparisAdet - yeniGonderilen;
                
               if (yeniGonderilen > siparis.siparisAdet) {
                    alert('GÃ¶nderilen adet sipariÅŸ adetini aÅŸamaz!');
                    return;
                }

                database.ref('siparisHazirlik/' + id).update({
                    gonderilenAdet: yeniGonderilen,
                    sonGuncelleme: new Date().toISOString()
                }).then(() => {
                    input.value = '';
                    showAlert('siparisEkleAlert', `âœ… ${eklenecekAdet} adet eklendi! Toplam gÃ¶nderilen: ${yeniGonderilen}, Kalan: ${kalanAdet}`, 'success');
                });
            });
        }

        // ==================== DÃœZENLEME FONKSÄ°YONLARI ====================
        function gorevDuzenle(id) {
            database.ref('gorevler/' + id).once('value').then((snapshot) => {
                const gorev = snapshot.val();
                if (!gorev) return;

                const modal = document.getElementById('editModal');
                const container = document.getElementById('editFormContainer');
                
                container.innerHTML = `
                    <form id="editGorevForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ğŸ“ GÃ¶rev BaÅŸlÄ±ÄŸÄ±</label>
                                <input type="text" id="editGorevBaslik" value="${gorev.baslik}" required>
                            </div>
                            <div class="form-group">
                                <label>âš ï¸ Aciliyet</label>
                                <select id="editGorevAciliyet" required>
                                    <option value="acil" ${gorev.aciliyet === 'acil' ? 'selected' : ''}>ğŸ”´ Acil</option>
                                    <option value="normal" ${gorev.aciliyet === 'normal' ? 'selected' : ''}>ğŸ”µ Normal</option>
                                    <option value="dusuk" ${gorev.aciliyet === 'dusuk' ? 'selected' : ''}>âšª DÃ¼ÅŸÃ¼k</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ğŸ‘¤ Atanan KiÅŸi</label>
                                <select id="editGorevAtanan">
                                    <option value="">Herkes</option>
                                    <option value="Esat" ${gorev.atanan === 'Esat' ? 'selected' : ''}>Esat</option>
                                    <option value="Ahmet" ${gorev.atanan === 'Ahmet' ? 'selected' : ''}>Ahmet</option>
                                    <option value="Emre" ${gorev.atanan === 'Emre' ? 'selected' : ''}>Emre</option>
                                    <option value="GÃ¶kay" ${gorev.atanan === 'GÃ¶kay' ? 'selected' : ''}>GÃ¶kay</option>
                                    <option value="Berke" ${gorev.atanan === 'Berke' ? 'selected' : ''}>Berke</option>
                                    <option value="Melisa" ${gorev.atanan === 'Melisa' ? 'selected' : ''}>Melisa</option>
                                    <option value="Evrim" ${gorev.atanan === 'Evrim' ? 'selected' : ''}>Evrim</option>
                                    <option value="Koray" ${gorev.atanan === 'Koray' ? 'selected' : ''}>Koray</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“„ AÃ§Ä±klama</label>
                                <textarea id="editGorevAciklama" rows="3">${gorev.aciklama || ''}</textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button type="submit" class="btn">ğŸ’¾ GÃ¼ncelle</button>
                            <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 10px;">âŒ Ä°ptal</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
                modal.style.display = 'block';
                
                document.getElementById('editGorevForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    database.ref('gorevler/' + id).update({
                        baslik: document.getElementById('editGorevBaslik').value.trim(),
                        aciliyet: document.getElementById('editGorevAciliyet').value,
                        atanan: document.getElementById('editGorevAtanan').value,
                        aciklama: document.getElementById('editGorevAciklama').value.trim()
                    }).then(() => {
                        closeEditModal();
                        showAlert('gorevAlert', 'GÃ¶rev baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    });
                });
            });
        }

        function siparisHazirlikDuzenle(id) {
            database.ref('siparisHazirlik/' + id).once('value').then((snapshot) => {
                const siparis = snapshot.val();
                if (!siparis) return;

                const modal = document.getElementById('editModal');
                const container = document.getElementById('editFormContainer');
                
                const checklist = siparis.malzemeChecklist || {
                    koli: false,
                    kutu: false,
                    izolasyon: false,
                    tapa: false,
                    poset: false
                };
                
                container.innerHTML = `
                    <form id="editSiparisForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ğŸ“… Tarih</label>
                                <input type="date" id="editSiparisTarih" value="${siparis.tarih}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ‘¤ OperatÃ¶r</label>
                                <select id="editSiparisOperator" required>
                                    <option value="Esat" ${siparis.operator === 'Esat' ? 'selected' : ''}>Esat</option>
                                    <option value="Ahmet" ${siparis.operator === 'Ahmet' ? 'selected' : ''}>Ahmet</option>
                                    <option value="Emre" ${siparis.operator === 'Emre' ? 'selected' : ''}>Emre</option>
                                    <option value="GÃ¶kay" ${siparis.operator === 'GÃ¶kay' ? 'selected' : ''}>GÃ¶kay</option>
                                    <option value="Berke" ${siparis.operator === 'Berke' ? 'selected' : ''}>Berke</option>
                                    <option value="Melisa" ${siparis.operator === 'Melisa' ? 'selected' : ''}>Melisa</option>
                                    <option value="Evrim" ${siparis.operator === 'Evrim' ? 'selected' : ''}>Evrim</option>
                                    <option value="Koray" ${siparis.operator === 'Koray' ? 'selected' : ''}>Koray</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ğŸ”¢ SipariÅŸ No</label>
                                <input type="text" id="editSiparisNo" value="${siparis.siparisNo}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“¦ ÃœrÃ¼n Kodu</label>
                                <input type="text" id="editUrunKodu" value="${siparis.urunKodu}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“Š SipariÅŸ Adedi</label>
                                <input type="number" id="editSiparisAdet" value="${siparis.siparisAdet}" min="1" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“¤ GÃ¶nderilen Adet</label>
                                <input type="number" id="editGonderilenAdet" value="${siparis.gonderilenAdet || 0}" min="0">
                            </div>
                            <div class="form-group" style="grid-column: 1/-1;">
                                <label>ğŸ“ Notlar</label>
                                <textarea id="editSiparisNotlar" rows="3">${siparis.notlar || ''}</textarea>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“Š Durum</label>
                                <select id="editSiparisDurum">
                                    <option value="beklemede" ${siparis.durum === 'beklemede' ? 'selected' : ''}>â³ Beklemede</option>
                                    <option value="tamamlandi" ${siparis.durum === 'tamamlandi' ? 'selected' : ''}>âœ… TamamlandÄ±</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Malzeme Checklist -->
                        <div style="margin-top: 20px;">
                            <label style="font-weight: 600; display: block; margin-bottom: 10px;">ğŸ“¦ Malzeme Durumu:</label>
                            <div class="malzeme-checklist">
                                <label>
                                    <input type="checkbox" id="editKoli" ${checklist.koli ? 'checked' : ''}>
                                    ğŸ“¦ Koli
                                </label>
                                <label>
                                    <input type="checkbox" id="editKutu" ${checklist.kutu ? 'checked' : ''}>
                                    ğŸ“¦ Kutu
                                </label>
                                <label>
                                    <input type="checkbox" id="editIzolasyon" ${checklist.izolasyon ? 'checked' : ''}>
                                    ğŸ§Š Ä°zolasyon
                                </label>
                                <label>
                                    <input type="checkbox" id="editTapa" ${checklist.tapa ? 'checked' : ''}>
                                    ğŸ”˜ Tapa
                                </label>
                                <label>
                                    <input type="checkbox" id="editPoset" ${checklist.poset ? 'checked' : ''}>
                                    ğŸ›ï¸ PoÅŸet
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; text-align: center;">
                            <button type="submit" class="btn">ğŸ’¾ GÃ¼ncelle</button>
                            <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 10px;">âŒ Ä°ptal</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
                modal.style.display = 'block';
                
                document.getElementById('editSiparisForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    database.ref('siparisHazirlik/' + id).update({
                        tarih: document.getElementById('editSiparisTarih').value,
                        operator: document.getElementById('editSiparisOperator').value,
                        siparisNo: document.getElementById('editSiparisNo').value.trim(),
                        urunKodu: document.getElementById('editUrunKodu').value.trim(),
                        siparisAdet: parseInt(document.getElementById('editSiparisAdet').value) || 0,
                        gonderilenAdet: parseInt(document.getElementById('editGonderilenAdet').value) || 0,
                        notlar: document.getElementById('editSiparisNotlar').value.trim(),
                        durum: document.getElementById('editSiparisDurum').value,
                        malzemeChecklist: {
                            koli: document.getElementById('editKoli').checked,
                            kutu: document.getElementById('editKutu').checked,
                            izolasyon: document.getElementById('editIzolasyon').checked,
                            tapa: document.getElementById('editTapa').checked,
                            poset: document.getElementById('editPoset').checked
                        },
                        sonGuncelleme: new Date().toISOString()
                    }).then(() => {
                        closeEditModal();
                        showAlert('siparisEkleAlert', 'SipariÅŸ baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    });
                });
            });
        }

        function urunSiparisDuzenle(id) {
            database.ref('urunSiparisler/' + id).once('value').then((snapshot) => {
                const siparis = snapshot.val();
                if (!siparis) return;

                const modal = document.getElementById('editModal');
                const container = document.getElementById('editFormContainer');
                
                container.innerHTML = `
                    <form id="editUrunSiparisForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ğŸ“¦ ÃœrÃ¼n AdÄ±</label>
                                <input type="text" id="editUrunAdi" value="${siparis.urunAdi}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“Š Adet / Miktar</label>
                                <input type="text" id="editAdetMiktar" value="${siparis.adetMiktar}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“ Ã–lÃ§Ã¼</label>
                                <input type="text" id="editOlcu" value="${siparis.olcu || ''}">
                            </div>
                            <div class="form-group">
                                <label>ğŸ‘¤ Talep Eden</label>
                                <select id="editTalepEden" required>
                                    <option value="Esat" ${siparis.talepEden === 'Esat' ? 'selected' : ''}>Esat</option>
                                    <option value="Ahmet" ${siparis.talepEden === 'Ahmet' ? 'selected' : ''}>Ahmet</option>
                                    <option value="Emre" ${siparis.talepEden === 'Emre' ? 'selected' : ''}>Emre</option>
                                    <option value="GÃ¶kay" ${siparis.talepEden === 'GÃ¶kay' ? 'selected' : ''}>GÃ¶kay</option>
                                    <option value="Berke" ${siparis.talepEden === 'Berke' ? 'selected' : ''}>Berke</option>
                                    <option value="Melisa" ${siparis.talepEden === 'Melisa' ? 'selected' : ''}>Melisa</option>
                                    <option value="Evrim" ${siparis.talepEden === 'Evrim' ? 'selected' : ''}>Evrim</option>
                                    <option value="Koray" ${siparis.talepEden === 'Koray' ? 'selected' : ''}>Koray</option>
                                </select>
                            </div>
                            <div class="form-group" style="grid-column: 1/-1;">
                                <label>ğŸ“ AÃ§Ä±klama / Not</label>
                                <textarea id="editSiparisAciklama" rows="3">${siparis.aciklama || ''}</textarea>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“Š Durum</label>
                                <select id="editUrunSiparisDurum">
                                    <option value="bekleniyor" ${siparis.durum === 'bekleniyor' ? 'selected' : ''}>â³ Bekleniyor</option>
                                    <option value="geldi" ${siparis.durum === 'geldi' ? 'selected' : ''}>âœ… Geldi</option>
                                    <option value="iptal" ${siparis.durum === 'iptal' ? 'selected' : ''}>âŒ Ä°ptal</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>âœ… Gelen Adet</label>
                                <input type="text" id="editGelenAdet" value="${siparis.gelenAdet || ''}">
                            </div>
                            <div class="form-group" style="grid-column: 1/-1;">
                                <label>ğŸ“Œ Gelen Notlar</label>
                                <textarea id="editGelenNotlar" rows="2">${siparis.gelenNotlar || ''}</textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button type="submit" class="btn">ğŸ’¾ GÃ¼ncelle</button>
                            <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 10px;">âŒ Ä°ptal</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
                modal.style.display = 'block';
                
                document.getElementById('editUrunSiparisForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    database.ref('urunSiparisler/' + id).update({
                        urunAdi: document.getElementById('editUrunAdi').value.trim(),
                        adetMiktar: document.getElementById('editAdetMiktar').value.trim(),
                        olcu: document.getElementById('editOlcu').value.trim(),
                        talepEden: document.getElementById('editTalepEden').value,
                        aciklama: document.getElementById('editSiparisAciklama').value.trim(),
                        durum: document.getElementById('editUrunSiparisDurum').value,
                        gelenAdet: document.getElementById('editGelenAdet').value.trim(),
                        gelenNotlar: document.getElementById('editGelenNotlar').value.trim()
                    }).then(() => {
                        closeEditModal();
                        showAlert('siparisAlert', 'ÃœrÃ¼n sipariÅŸi baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    });
                });
            });
        }

        function stokDuzenle(id) {
            database.ref('stok/' + id).once('value').then((snapshot) => {
                const stok = snapshot.val();
                if (!stok) return;

                const modal = document.getElementById('editModal');
                const container = document.getElementById('editFormContainer');
                
                container.innerHTML = `
                    <form id="editStokForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ğŸ”§ Malzeme TÃ¼rÃ¼</label>
                                <select id="editMalzemeTuru" required>
                                    <option value="izolasyon" ${stok.malzemeTuru === 'izolasyon' ? 'selected' : ''}>Ä°zolasyon</option>
                                    <option value="koli" ${stok.malzemeTuru === 'koli' ? 'selected' : ''}>Koli</option>
                                    <option value="kutu" ${stok.malzemeTuru === 'kutu' ? 'selected' : ''}>Kutu</option>
                                    <option value="poset" ${stok.malzemeTuru === 'poset' ? 'selected' : ''}>PoÅŸet</option>
                                    <option value="tapa" ${stok.malzemeTuru === 'tapa' ? 'selected' : ''}>Tapa</option>
                                    <option value="etiket" ${stok.malzemeTuru === 'etiket' ? 'selected' : ''}>Etiket</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“¦ ÃœrÃ¼n AdÄ±</label>
                                <input type="text" id="editStokUrunAdi" value="${stok.urunAdi}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“ Ã–lÃ§Ã¼ler</label>
                                <input type="text" id="editStokOlculeri" value="${stok.olculeri || ''}">
                            </div>
                            <div class="form-group">
                                <label>ğŸ“Š Mevcut Adet</label>
                                <input type="number" id="editStokMevcutAdet" value="${stok.mevcutAdet}" required>
                            </div>
                            <div class="form-group">
                                <label>ğŸ‘¤ Ekleyen</label>
                                <select id="editStokEkleyen" required>
                                    <option value="Esat" ${stok.ekleyen === 'Esat' ? 'selected' : ''}>Esat</option>
                                    <option value="Ahmet" ${stok.ekleyen === 'Ahmet' ? 'selected' : ''}>Ahmet</option>
                                    <option value="Emre" ${stok.ekleyen === 'Emre' ? 'selected' : ''}>Emre</option>
                                    <option value="GÃ¶kay" ${stok.ekleyen === 'GÃ¶kay' ? 'selected' : ''}>GÃ¶kay</option>
                                    <option value="Berke" ${stok.ekleyen === 'Berke' ? 'selected' : ''}>Berke</option>
                                    <option value="Melisa" ${stok.ekleyen === 'Melisa' ? 'selected' : ''}>Melisa</option>
                                    <option value="Evrim" ${stok.ekleyen === 'Evrim' ? 'selected' : ''}>Evrim</option>
                                    <option value="Koray" ${stok.ekleyen === 'Koray' ? 'selected' : ''}>Koray</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button type="submit" class="btn">ğŸ’¾ GÃ¼ncelle</button>
                            <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 10px;">âŒ Ä°ptal</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
                modal.style.display = 'block';
                
                document.getElementById('editStokForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    database.ref('stok/' + id).update({
                        malzemeTuru: document.getElementById('editMalzemeTuru').value,
                        urunAdi: document.getElementById('editStokUrunAdi').value.trim(),
                        olculeri: document.getElementById('editStokOlculeri').value.trim(),
                        mevcutAdet: parseInt(document.getElementById('editStokMevcutAdet').value) || 0,
                        ekleyen: document.getElementById('editStokEkleyen').value,
                        sonGuncelleme: new Date().toISOString()
                    }).then(() => {
                        closeEditModal();
                        showAlert('stokAlert', 'Stok baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    });
                });
            });
        }

        function closeEditModal() {
            const modal = document.getElementById('editModal');
            modal.classList.remove('active');
            modal.style.display = 'none';
        }

        // ==================== JSON Ä°NDÄ°RME ====================
        function firebaseVerileriniIndir() {
            const statusArea = document.getElementById('importStatus');
            statusArea.innerHTML = '<div class="alert" style="background: #d1ecf1; color: #0c5460;">ğŸ”„ Veriler Firebase\'den Ã§ekiliyor...</div>';

            const promises = [
                database.ref('gorevler').once('value'),
                database.ref('siparisHazirlik').once('value'),
                database.ref('urunSiparisler').once('value'),
                database.ref('stok').once('value')
            ];

            Promise.all(promises).then(([gorevSnap, siparisSnap, urunSnap, stokSnap]) => {
                const exportData = {
                    exportDate: new Date().toISOString(),
                    gorevler: [],
                    siparisHazirlik: [],
                    urunSiparisler: [],
                    stok: []
                };

                // GÃ¶revleri topla
                gorevSnap.forEach((child) => {
                    exportData.gorevler.push(child.val());
                });

                // SipariÅŸleri topla
                siparisSnap.forEach((child) => {
                    exportData.siparisHazirlik.push(child.val());
                });

                // ÃœrÃ¼n sipariÅŸlerini topla
                urunSnap.forEach((child) => {
                    exportData.urunSiparisler.push(child.val());
                });

                // StoklarÄ± topla
                stokSnap.forEach((child) => {
                    exportData.stok.push(child.val());
                });

                // JSON dosyasÄ± oluÅŸtur ve indir
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `akg_firebase_yedek_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                const toplam = exportData.gorevler.length + exportData.siparisHazirlik.length + 
                              exportData.urunSiparisler.length + exportData.stok.length;

                statusArea.innerHTML = `
                    <div class="alert alert-success">
                        âœ… Veriler baÅŸarÄ±yla indirildi!<br><br>
                        ğŸ“‹ GÃ¼ncel Ä°ÅŸler: ${exportData.gorevler.length} kayÄ±t<br>
                        ğŸ“¦ SipariÅŸ HazÄ±rlÄ±k: ${exportData.siparisHazirlik.length} kayÄ±t<br>
                        ğŸ›’ ÃœrÃ¼n SipariÅŸleri: ${exportData.urunSiparisler.length} kayÄ±t<br>
                        ğŸ“Š Stok: ${exportData.stok.length} kayÄ±t<br><br>
                        <strong>Toplam: ${toplam} kayÄ±t</strong>
                    </div>
                `;
            }).catch((error) => {
                statusArea.innerHTML = `<div class="alert alert-error">âŒ Hata: ${error.message}</div>`;
            });
        }

        function siparisSil(id) {
            if (confirm('Bu sipariÅŸi silmek istediÄŸinizden emin misiniz?')) {
                database.ref('siparisHazirlik/' + id).remove()
                    .then(() => showAlert('siparisEkleAlert', 'SipariÅŸ silindi!', 'success'))
                    .catch((error) => showAlert('siparisEkleAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        // ==================== ÃœRÃœN SÄ°PARÄ°ÅLERÄ° ====================
        function listenToUrunSiparisler() {
            database.ref('urunSiparisler').on('value', (snapshot) => {
                const siparisler = [];
                snapshot.forEach((childSnapshot) => {
                    siparisler.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadUrunSiparislerListesi(siparisler);
            });
        }

        function urunSiparisEkle(e) {
            e.preventDefault();
            
            const siparisData = {
                urunAdi: document.getElementById('siparisUrunAdi').value.trim(),
                adetMiktar: document.getElementById('siparisAdetMiktar').value.trim(),
                olcu: document.getElementById('siparisOlcu').value.trim(),
                aciklama: document.getElementById('siparisAciklama').value.trim(),
                talepEden: document.getElementById('siparisTalipEden').value,
                durum: 'bekleniyor',
                olusturmaTarihi: new Date().toISOString(),
                gelenAdet: '',
                gelenNotlar: ''
            };

            database.ref('urunSiparisler').push(siparisData)
                .then(() => {
                    document.getElementById('urunSiparisForm').reset();
                    showAlert('siparisAlert', 'SipariÅŸ baÅŸarÄ±yla eklendi!', 'success');
                })
                .catch((error) => {
                    showAlert('siparisAlert', 'Hata: ' + error.message, 'error');
                });
        }

        function loadUrunSiparislerListesi(siparisler) {
            const container = document.getElementById('urunSiparislerListesi');
            if (!container) return;

            // Ã–zet gÃ¼ncelle
            guncelleUrunSiparisOzeti(siparisler);

            let filtrelenmissiparisler = siparisler;
            if (currentSiparisFilter !== 'hepsi') {
                filtrelenmissiparisler = siparisler.filter(s => s.durum === currentSiparisFilter);
            }

            if (filtrelenmissiparisler.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z sipariÅŸ bulunmuyor.</p>';
                return;
            }

            let html = '<div style="margin-top: 20px;">';
            filtrelenmissiparisler.slice().reverse().forEach(siparis => {
                const durumText = siparis.durum === 'bekleniyor' ? 'Bekleniyor' : 
                                  siparis.durum === 'geldi' ? 'Geldi' : 'Ä°ptal';
                
                html += `
                   <div class="kayit-item">
                        <div class="kayit-header">
                            <div><strong>ğŸ“¦ ${siparis.urunAdi}</strong></div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="durum-badge ${siparis.durum}">${durumText}</span>
                                <button class="btn-edit" onclick="urunSiparisDuzenle('${siparis.id}')">âœï¸</button>
                                <button class="btn-delete" onclick="urunSiparisSil('${siparis.id}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <div class="kayit-details">
                            <div><strong>ğŸ“Š Adet/Miktar:</strong> ${siparis.adetMiktar}</div>
                            ${siparis.olcu ? `<div><strong>ğŸ“ Ã–lÃ§Ã¼:</strong> ${siparis.olcu}</div>` : ''}
                            <div><strong>ğŸ‘¤ Talep Eden:</strong> ${siparis.talepEden}</div>
                            <div><strong>ğŸ“… Tarih:</strong> ${new Date(siparis.olusturmaTarihi).toLocaleString('tr-TR')}</div>
                            ${siparis.aciklama ? `<div style="grid-column: 1/-1;"><strong>ğŸ“ AÃ§Ä±klama:</strong> ${siparis.aciklama}</div>` : ''}
                            ${siparis.gelenAdet ? `<div><strong>âœ… Gelen Adet:</strong> ${siparis.gelenAdet}</div>` : ''}
                            ${siparis.gelenNotlar ? `<div style="grid-column: 1/-1;"><strong>ğŸ“Œ Notlar:</strong> ${siparis.gelenNotlar}</div>` : ''}
                        </div>
                        ${siparis.durum === 'bekleniyor' ? `
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-success" onclick="siparisGeldi('${siparis.id}', '${siparis.adetMiktar}')">âœ… Geldi Olarak Ä°ÅŸaretle</button>
                                <button class="btn btn-danger" onclick="siparisIptal('${siparis.id}')">âŒ Ä°ptal Et</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function guncelleUrunSiparisOzeti(siparisler) {
            const container = document.getElementById('urunSiparisOzeti');
            if (!container) return;

            const bekleniyor = siparisler.filter(s => s.durum === 'bekleniyor').length;
            const geldi = siparisler.filter(s => s.durum === 'geldi').length;
            const iptal = siparisler.filter(s => s.durum === 'iptal').length;

            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #f39c12;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #f39c12;">${bekleniyor}</div>
                        <div style="color: #666; margin-top: 5px;">â³ Bekleniyor</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #27ae60;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #27ae60;">${geldi}</div>
                        <div style="color: #666; margin-top: 5px;">âœ… Geldi</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #95a5a6;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #95a5a6;">${iptal}</div>
                        <div style="color: #666; margin-top: 5px;">âŒ Ä°ptal</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #3498db;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #3498db;">${siparisler.length}</div>
                        <div style="color: #666; margin-top: 5px;">ğŸ“¦ Toplam</div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function siparisGeldi(id, defaultAdet) {
            const gelenAdet = prompt('Gelen adet/miktarÄ± girin:', defaultAdet);
            if (gelenAdet === null) return;

            const notlar = prompt('Not eklemek ister misiniz?', '');

            database.ref('urunSiparisler/' + id).update({
                durum: 'geldi',
                gelenAdet: gelenAdet,
                gelenNotlar: notlar || '',
                gelisTarihi: new Date().toISOString()
            }).then(() => {
                showAlert('siparisAlert', 'SipariÅŸ "Geldi" olarak iÅŸaretlendi!', 'success');
            });
        }

        function siparisIptal(id) {
            if (confirm('Bu sipariÅŸi iptal etmek istediÄŸinizden emin misiniz?')) {
                database.ref('urunSiparisler/' + id).update({
                    durum: 'iptal'
                }).then(() => {
                    showAlert('siparisAlert', 'SipariÅŸ iptal edildi!', 'success');
                });
            }
        }

        function urunSiparisSil(id) {
            if (confirm('Bu sipariÅŸi silmek istediÄŸinizden emin misiniz?')) {
                database.ref('urunSiparisler/' + id).remove()
                    .then(() => showAlert('siparisAlert', 'SipariÅŸ silindi!', 'success'))
                    .catch((error) => showAlert('siparisAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        function filtreSiparisler(durum) {
            currentSiparisFilter = durum;
            listenToUrunSiparisler();
        }

        // ==================== STOK YÃ–NETÄ°MÄ° ====================
        function listenToStok() {
            database.ref('stok').on('value', (snapshot) => {
                const stoklar = [];
                snapshot.forEach((childSnapshot) => {
                    stoklar.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                loadStokListesi(stoklar);
            });
        }

        function stokEkleGuncelle(e) {
            if (e) e.preventDefault();
            
            const malzemeTuru = document.getElementById('stokMalzemeTuru').value;
            const urunAdi = document.getElementById('stokUrunAdi').value.trim();
            const olculeri = document.getElementById('stokOlculeri').value.trim();
            const mevcutAdet = parseInt(document.getElementById('stokMevcut').value);
            const ekleyen = document.getElementById('stokEkleyen').value;

            if (!malzemeTuru || !urunAdi || !ekleyen || isNaN(mevcutAdet)) {
                showAlert('stokAlert', 'LÃ¼tfen tÃ¼m gerekli alanlarÄ± doldurunuz!', 'error');
                return;
            }

            // AynÄ± Ã¼rÃ¼n var mÄ± kontrol et
            database.ref('stok').orderByChild('urunAdi').equalTo(urunAdi).once('value').then((snapshot) => {
                let existingId = null;
                snapshot.forEach((childSnapshot) => {
                    const stok = childSnapshot.val();
                    if (stok.malzemeTuru === malzemeTuru && stok.olculeri === olculeri) {
                        existingId = childSnapshot.key;
                    }
                });

                const yeniStok = {
                    malzemeTuru: malzemeTuru,
                    urunAdi: urunAdi,
                    olculeri: olculeri,
                    mevcutAdet: mevcutAdet,
                    ekleyen: ekleyen,
                    sonGuncelleme: new Date().toISOString()
                };

                if (existingId) {
                    database.ref('stok/' + existingId).update(yeniStok)
                        .then(() => {
                            showAlert('stokAlert', 'Stok baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                            temizleStokFormu();
                        });
                } else {
                    database.ref('stok').push(yeniStok)
                        .then(() => {
                            showAlert('stokAlert', 'Stok baÅŸarÄ±yla eklendi!', 'success');
                            temizleStokFormu();
                        });
                }
            });
        }

        function loadStokListesi(stoklar) {
            const container = document.getElementById('stokListesi');
            if (!container) return;

            // Stok Ã¶zeti gÃ¼ncelle
            guncellleStokOzeti(stoklar);

            if (stoklar.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z stok kaydÄ± bulunmuyor.</p>';
                return;
            }

            let html = '';
            stoklar.forEach(stok => {
                html += `
                    <div class="stok-kayit-item">
                        <div class="stok-header">
                            <h4>ğŸ“¦ ${stok.urunAdi}</h4>
                            <span style="background: #3498db; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                                ${stok.malzemeTuru.toUpperCase()}
                            </span>
                        </div>
                        <div class="stok-bilgi">
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ“ Ã–lÃ§Ã¼ler:</strong></span>
                                <span>${stok.olculeri || 'BelirtilmemiÅŸ'}</span>
                            </div>
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ“Š Mevcut Adet:</strong></span>
                                <span style="font-weight: bold; color: ${stok.mevcutAdet > 0 ? '#27ae60' : stok.mevcutAdet < 0 ? '#e74c3c' : '#f39c12'};">
                                    ${stok.mevcutAdet}
                                </span>
                            </div>
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ‘¤ Ekleyen:</strong></span>
                                <span>${stok.ekleyen}</span>
                            </div>
                            <div class="stok-bilgi-item">
                                <span><strong>ğŸ•’ Son GÃ¼ncelleme:</strong></span>
                                <span>${new Date(stok.sonGuncelleme).toLocaleString('tr-TR')}</span>
                            </div>
                        </div>
                        
                        <!-- Eklenen Adet -->
                        <div style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px; border: 2px solid #27ae60;">
                            <label style="font-weight: 600; display: block; margin-bottom: 5px; color: #27ae60;">â• Eklenen Adet:</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="stok-adet-input" id="eklenen-${stok.id}" placeholder="Eklenecek adet" min="0" style="border-color: #27ae60;">
                                <button class="btn btn-success" onclick="stokEkle('${stok.id}')" style="padding: 5px 15px;">â• Ekle</button>
                            </div>
                        </div>

                        <!-- KullanÄ±lan Adet -->
                        <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 6px; border: 2px solid #f39c12;">
                            <label style="font-weight: 600; display: block; margin-bottom: 5px; color: #f39c12;">ğŸ“‰ KullanÄ±lan Adet:</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="stok-adet-input" id="kullanilan-${stok.id}" placeholder="KullanÄ±lan adet" min="0" style="border-color: #f39c12;">
                                <button class="btn" onclick="stokKullan('${stok.id}')" style="padding: 5px 15px; background: linear-gradient(135deg, #f39c12, #e67e22);">â– Kullan</button>
                            </div>
                        </div>

                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn-edit" onclick="stokDuzenle('${stok.id}')" style="margin-right: 10px;">âœï¸ DÃ¼zenle</button>
                            <button class="btn-delete" onclick="stokSil('${stok.id}')">ğŸ—‘ï¸ Sil</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function guncellleStokOzeti(stoklar) {
            const container = document.getElementById('stokOzeti');
            if (!container) return;

            if (stoklar.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">HenÃ¼z stok kaydÄ± bulunmuyor.</p>';
                return;
            }

            // StoklarÄ± tÃ¼re gÃ¶re grupla
            const stokGruplari = {};
            stoklar.forEach(stok => {
                if (!stokGruplari[stok.malzemeTuru]) {
                    stokGruplari[stok.malzemeTuru] = [];
                }
                stokGruplari[stok.malzemeTuru].push(stok);
            });

            let html = '';
            Object.keys(stokGruplari).sort().forEach(tur => {
                const turStoklar = stokGruplari[tur];
                const toplamAdet = turStoklar.reduce((total, stok) => total + stok.mevcutAdet, 0);
                
                html += `
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e9ecef;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px; text-transform: uppercase; background: #3498db; color: white; padding: 8px; border-radius: 4px; text-align: center;">
                            ğŸ“¦ ${tur} (Toplam: ${toplamAdet} adet)
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                `;
                
                turStoklar.forEach(stok => {
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid ${stok.mevcutAdet > 0 ? '#27ae60' : stok.mevcutAdet < 0 ? '#e74c3c' : '#f39c12'};">
                            <span style="font-weight: 600; font-size: 13px;">${stok.urunAdi}</span>
                            <span style="font-weight: bold; color: ${stok.mevcutAdet > 0 ? '#27ae60' : stok.mevcutAdet < 0 ? '#e74c3c' : '#f39c12'};">${stok.mevcutAdet}</span>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        function stokEkle(id) {
            const input = document.getElementById(`eklenen-${id}`);
            const eklenenAdet = parseInt(input.value);
            
            if (isNaN(eklenenAdet) || eklenenAdet <= 0) {
                alert('LÃ¼tfen geÃ§erli bir adet giriniz!');
                return;
            }

            database.ref('stok/' + id).once('value').then((snapshot) => {
                const stok = snapshot.val();
                const yeniAdet = stok.mevcutAdet + eklenenAdet;
                
                database.ref('stok/' + id).update({
                    mevcutAdet: yeniAdet,
                    sonGuncelleme: new Date().toISOString()
                }).then(() => {
                    input.value = '';
                    showAlert('stokAlert', `${eklenenAdet} adet eklendi. Yeni stok: ${yeniAdet}`, 'success');
                });
            });
        }

        function stokKullan(id) {
            const input = document.getElementById(`kullanilan-${id}`);
            const kullanilanAdet = parseInt(input.value);
            
            if (isNaN(kullanilanAdet) || kullanilanAdet <= 0) {
                alert('LÃ¼tfen geÃ§erli bir adet giriniz!');
                return;
            }

            database.ref('stok/' + id).once('value').then((snapshot) => {
                const stok = snapshot.val();
                const yeniAdet = stok.mevcutAdet - kullanilanAdet;
                
                database.ref('stok/' + id).update({
                    mevcutAdet: yeniAdet,
                    sonGuncelleme: new Date().toISOString()
                }).then(() => {
                    input.value = '';
                    showAlert('stokAlert', `${kullanilanAdet} adet kullanÄ±ldÄ±. Yeni stok: ${yeniAdet}`, 'success');
                });
            });
        }

        function stokSil(id) {
            if (confirm('Bu stok kaydÄ±nÄ± silmek istediÄŸinizden emin misiniz?')) {
                database.ref('stok/' + id).remove()
                    .then(() => showAlert('stokAlert', 'Stok kaydÄ± silindi!', 'success'))
                    .catch((error) => showAlert('stokAlert', 'Hata: ' + error.message, 'error'));
            }
        }

        function temizleStokFormu() {
            document.getElementById('stokForm').reset();
        }

        // ==================== VERÄ° AKTARMA ====================
        function verileriYukle() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('LÃ¼tfen bir JSON dosyasÄ± seÃ§in!');
                return;
            }

            const statusArea = document.getElementById('importStatus');
            statusArea.innerHTML = '<div class="alert" style="background: #d1ecf1; color: #0c5460;">ğŸ”„ Veriler yÃ¼kleniyor...</div>';

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const veriler = JSON.parse(e.target.result);
                    
                    if (!veriler.gorevler && !veriler.siparisHazirlik && !veriler.urunSiparisler && !veriler.stok) {
                        throw new Error('GeÃ§ersiz veri formatÄ±!');
                    }

                    let toplamEklenen = 0;
                    const promises = [];

                    // GÃ¶revleri aktar
                    if (veriler.gorevler && veriler.gorevler.length > 0) {
                        veriler.gorevler.forEach(gorev => {
                            delete gorev.id;
                            promises.push(
                                database.ref('gorevler').push(gorev).then(() => toplamEklenen++)
                            );
                        });
                    }

                    // SipariÅŸ HazÄ±rlÄ±k verilerini aktar
                    if (veriler.siparisHazirlik && veriler.siparisHazirlik.length > 0) {
                        veriler.siparisHazirlik.forEach(siparis => {
                            delete siparis.id;
                            promises.push(
                                database.ref('siparisHazirlik').push(siparis).then(() => toplamEklenen++)
                            );
                        });
                    }

                    // ÃœrÃ¼n SipariÅŸlerini aktar
                    if (veriler.urunSiparisler && veriler.urunSiparisler.length > 0) {
                        veriler.urunSiparisler.forEach(siparis => {
                            delete siparis.id;
                            promises.push(
                                database.ref('urunSiparisler').push(siparis).then(() => toplamEklenen++)
                            );
                        });
                    }

                    // Stok verilerini aktar
                    if (veriler.stok && veriler.stok.length > 0) {
                        veriler.stok.forEach(stok => {
                            delete stok.id;
                            promises.push(
                                database.ref('stok').push(stok).then(() => toplamEklenen++)
                            );
                        });
                    }

                    // TÃ¼m iÅŸlemler tamamlandÄ±ÄŸÄ±nda
                    Promise.all(promises)
                        .then(() => {
                            statusArea.innerHTML = `
                                <div class="alert alert-success">
                                    âœ… BaÅŸarÄ±lÄ±! Toplam ${toplamEklenen} kayÄ±t Firebase'e aktarÄ±ldÄ±!<br><br>
                                    ğŸ“‹ GÃ¼ncel Ä°ÅŸler: ${veriler.gorevler ? veriler.gorevler.length : 0} kayÄ±t<br>
                                    ğŸ“¦ SipariÅŸ HazÄ±rlÄ±k: ${veriler.siparisHazirlik ? veriler.siparisHazirlik.length : 0} kayÄ±t<br>
                                    ğŸ›’ ÃœrÃ¼n SipariÅŸleri: ${veriler.urunSiparisler ? veriler.urunSiparisler.length : 0} kayÄ±t<br>
                                    ğŸ“Š Stok: ${veriler.stok ? veriler.stok.length : 0} kayÄ±t
                                </div>
                            `;
                            fileInput.value = '';
                        })
                        .catch((error) => {
                            statusArea.innerHTML = `<div class="alert alert-error">âŒ Hata: ${error.message}</div>`;
                        });

                } catch (error) {
                    statusArea.innerHTML = `<div class="alert alert-error">âŒ Dosya okuma hatasÄ±: ${error.message}</div>`;
                }
            };
            reader.readAsText(file);
        }

        function tumFirebaseVerileriniSil() {
            if (!confirm('âš ï¸ TÃœM FIREBASE VERÄ°LERÄ° SÄ°LÄ°NECEK!\n\nBu iÅŸlem geri alÄ±namaz. Emin misiniz?')) {
                return;
            }

            if (!confirm('ğŸš¨ SON UYARI!\n\nGerÃ§ekten tÃ¼m verileri silmek istiyor musunuz?\n\nBu iÅŸlem:\nâ€¢ TÃ¼m gÃ¶revleri\nâ€¢ TÃ¼m sipariÅŸleri\nâ€¢ TÃ¼m stoklarÄ±\nkalÄ±cÄ± olarak silecek!')) {
                return;
            }

            const statusArea = document.getElementById('importStatus');
            statusArea.innerHTML = '<div class="alert" style="background: #f8d7da; color: #721c24;">ğŸ”„ Veriler siliniyor...</div>';

            const promises = [
                database.ref('gorevler').remove(),
                database.ref('siparisHazirlik').remove(),
                database.ref('urunSiparisler').remove(),
                database.ref('stok').remove()
            ];

            Promise.all(promises)
                .then(() => {
                    statusArea.innerHTML = '<div class="alert alert-success">âœ… TÃ¼m Firebase verileri baÅŸarÄ±yla silindi!</div>';
                })
                .catch((error) => {
                    statusArea.innerHTML = `<div class="alert alert-error">âŒ Hata: ${error.message}</div>`;
                });
        }

        // ==================== GENEL FONKSÄ°YONLAR ====================
        function showTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }
    </script>
</body>
</html>
