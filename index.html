<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stok Takip v3 - Final</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .app-container { display: flex; min-height: 100vh; max-width: 1920px; margin: 0 auto; background: white; }
        
        /* Sidebar */
        .sidebar { 
            width: 280px; 
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%); 
            color: white; 
            padding: 2rem 0; 
            position: fixed; 
            height: 100vh; 
            overflow-y: auto; 
            z-index: 1000;
        }
        .sidebar-header { padding: 0 1.5rem 2rem; border-bottom: 2px solid rgba(255,255,255,0.1); }
        .sidebar h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .nav-menu { list-style: none; padding: 1rem 0; }
        .nav-item { 
            padding: 0.75rem 1.5rem; 
            cursor: pointer; 
            display: flex; 
            gap: 0.75rem;
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: rgba(255,255,255,0.15); border-left-color: #10b981; }
        
        .btn-group { padding: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .sidebar-btn {
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-export { background: #f59e0b; color: white; }
        .btn-import { background: #10b981; color: white; }
        
        /* Main */
        .main-content { flex: 1; margin-left: 280px; padding: 2rem; background: #f8fafc; }
        .page-header { 
            background: white; 
            padding: 1.5rem; 
            border-radius: 1rem; 
            margin-bottom: 2rem; 
            display: flex; 
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }
        .stat-card.blue::before { background: #3b82f6; }
        .stat-card.orange::before { background: #f59e0b; }
        .stat-card.green::before { background: #10b981; }
        .stat-card.red::before { background: #ef4444; }
        .stat-card h3 { font-size: 0.875rem; color: #64748b; margin-bottom: 0.5rem; text-transform: uppercase; }
        .stat-card .value { font-size: 2rem; font-weight: bold; color: #1e293b; }
        
        /* Table */
        .table-container { background: white; border-radius: 1rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .table-header { 
            padding: 1.5rem; 
            background: linear-gradient(135deg, #3b82f6, #10b981); 
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { 
            padding: 1rem; 
            background: #f1f5f9; 
            text-align: left; 
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
        }
        .data-table td { padding: 0.75rem; border-bottom: 1px solid #e2e8f0; }
        .data-table tbody tr:hover { background: #f8fafc; }
        
        /* Editable */
        .editable { 
            cursor: pointer; 
            padding: 0.5rem; 
            background: #fef3c7; 
            border-radius: 0.25rem; 
            min-width: 60px; 
            display: inline-block; 
            border: 2px solid transparent; 
        }
        .editable:hover { background: #fde68a; border-color: #f59e0b; }
        .editable:focus { outline: none; background: white; border-color: #3b82f6; }
        
        .auto-cell {
            background: #e5e7eb;
            font-weight: 600;
            text-align: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        
        .input-cell { 
            padding: 0.5rem; 
            border-radius: 0.25rem; 
            width: 80px; 
            text-align: center; 
            border: 2px solid; 
            font-size: 0.875rem;
        }
        .input-yellow { background: #fef3c7; border-color: #f59e0b; }
        .input-green { background: #d1fae5; border-color: #10b981; }
        .input-red { background: #fee2e2; border-color: #ef4444; }
        
        .btn { 
            padding: 0.5rem 1rem; 
            border: none; 
            border-radius: 0.5rem; 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        
        .toast { 
            position: fixed; 
            top: 2rem; 
            right: 2rem; 
            background: white; 
            padding: 1rem 1.5rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
            z-index: 10000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .toast.success { border-left: 4px solid #10b981; }
        .toast.error { border-left: 4px solid #ef4444; }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .hidden { display: none !important; }
        
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .badge.warning { background: #fef3c7; color: #92400e; }
        .badge.info { background: #dbeafe; color: #1e40af; }
        
        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 1rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .data-table { font-size: 0.875rem; }
            .data-table th, .data-table td { padding: 0.5rem; }
        }
        
        .file-input { display: none; }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üè≠ Stok Takip v3</h1>
                <p>Otomatik √ñzet Sistem</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" onclick="showPage('anasayfa')">
                    <span>üìã</span><span>Ana Sayfa (√ñzet)</span>
                </li>
                <li class="nav-item" onclick="showPage('temizlemeye')">
                    <span>üöÄ</span><span>Temizlemeye</span>
                </li>
                <li class="nav-item" onclick="showPage('temizlemede')">
                    <span>üßº</span><span>Temizlemede</span>
                </li>
                <li class="nav-item" onclick="showPage('temizlemeden')">
                    <span>‚úÖ</span><span>Gelen</span>
                </li>
                <li class="nav-item" onclick="showPage('sevke')">
                    <span>üì¶</span><span>Sevke Hazƒ±r</span>
                </li>
                <li class="nav-item" onclick="showPage('sevkedilen')">
                    <span>üöö</span><span>Sevk Edilen</span>
                </li>
                <li class="nav-item" onclick="showPage('problemli')">
                    <span>‚ö†Ô∏è</span><span>Problemli</span>
                </li>
                <li class="nav-item" onclick="showPage('kalan')">
                    <span>üìä</span><span>Kalan</span>
                </li>
                <li class="nav-item" onclick="showPage('gecmis')">
                    <span>üìú</span><span>Ge√ßmi≈ü</span>
                </li>
            </ul>
            <div class="btn-group">
                <button class="sidebar-btn btn-export" onclick="exportJSON()">
                    <span>üíæ</span><span>JSON ƒ∞ndir</span>
                </button>
                <button class="sidebar-btn btn-import" onclick="document.getElementById('fileInput').click()">
                    <span>üì•</span><span>JSON Y√ºkle</span>
                </button>
                <input type="file" id="fileInput" class="file-input" accept=".json" onchange="importJSON(event)">
            </div>
        </aside>
        
        <main class="main-content">
            <!-- Ana Sayfa -->
            <div id="anasayfa-page" class="page-content">
                <div class="page-header">
                    <h2>üìã Ana Sayfa - Otomatik √ñzet</h2>
                    <div style="display:flex;gap:0.5rem;">
                        <span class="badge info">Otomatik G√ºncellenir</span>
                        <button class="btn btn-success" onclick="addNewRow('anasayfa')">+ Yeni √úr√ºn</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <h3>Temizlemeye Gidecek</h3>
                        <div class="value" id="stat-temizlemeye">0</div>
                    </div>
                    <div class="stat-card orange">
                        <h3>Temizlemede Olan</h3>
                        <div class="value" id="stat-temizlemede">0</div>
                    </div>
                    <div class="stat-card green">
                        <h3>Sevke Hazƒ±r</h3>
                        <div class="value" id="stat-sevke">0</div>
                    </div>
                    <div class="stat-card red">
                        <h3>Problemli</h3>
                        <div class="value" id="stat-problem">0</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>T√ºm √úr√ºnler (Sarƒ±=D√ºzenlenebilir, Gri=Otomatik)</h3>
                    </div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tip</th>
                                    <th>√úr√ºn Kodu</th>
                                    <th>Toplam Stok</th>
                                    <th>Temizlemeye</th>
                                    <th>Temizlemede</th>
                                    <th>Sevke Hazƒ±r</th>
                                    <th>Kalan</th>
                                    <th>Sevk Edilen</th>
                                    <th>Problem</th>
                                    <th>ƒ∞≈ülem</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-anasayfa"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Temizlemeye -->
            <div id="temizlemeye-page" class="page-content hidden">
                <div class="page-header">
                    <h2>üöÄ Temizlemeye Gidecek</h2>
                    <div style="display:flex;gap:0.5rem;">
                        <span class="badge warning">Enter ile g√∂nder</span>
                        <button class="btn btn-success" onclick="addNewRow('temizlemeye')">+ Yeni</button>
                    </div>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>Temizlemeye G√∂nder</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>√úr√ºn Kodu</th><th>Mevcut</th><th>+ G√∂nder</th><th>ƒ∞≈ülem</th></tr></thead>
                            <tbody id="tbody-temizlemeye"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Temizlemede -->
            <div id="temizlemede-page" class="page-content hidden">
                <div class="page-header">
                    <h2>üßº Temizlemede Olan</h2>
                    <div style="display:flex;gap:0.5rem;">
                        <span class="badge warning">Enter ile tamamla</span>
                        <button class="btn btn-success" onclick="addNewRow('temizlemede')">+ Yeni</button>
                    </div>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>Temizleme Tamamla</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>√úr√ºn Kodu</th><th>Mevcut</th><th>+ Tamamlandƒ±</th><th>ƒ∞≈ülem</th></tr></thead>
                            <tbody id="tbody-temizlemede"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Temizlemeden Gelen -->
            <div id="temizlemeden-page" class="page-content hidden">
                <div class="page-header">
                    <h2>‚úÖ Temizlemeden Gelen</h2>
                    <span class="badge info">A+B E≈üle≈ütir (Min sevke, fazla kalana)</span>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>A ve B Par√ßa Giri≈üi</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>√úr√ºn</th><th>Mevcut</th><th>A Giri≈ü</th><th>B Giri≈ü</th><th>ƒ∞≈ülem</th></tr></thead>
                            <tbody id="tbody-temizlemeden"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Sevke Hazƒ±r -->
            <div id="sevke-page" class="page-content hidden">
                <div class="page-header">
                    <h2>üì¶ Sevke Hazƒ±r</h2>
                    <span class="badge warning">Manuel ƒ∞rsaliye Giri≈üi</span>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>Sevk Et</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>√úr√ºn</th><th>Mevcut</th><th>Adet</th><th>ƒ∞rsaliye</th><th>Yer</th><th>ƒ∞≈ülem</th></tr></thead>
                            <tbody id="tbody-sevke"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Sevk Edilen -->
            <div id="sevkedilen-page" class="page-content hidden">
                <div class="page-header">
                    <h2>üöö Sevk Edilen</h2>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>Sevk Ge√ßmi≈üi</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>√úr√ºn</th><th>Tarih</th><th>Adet</th><th>ƒ∞rsaliye</th><th>Yer</th></tr></thead>
                            <tbody id="tbody-sevkedilen"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Problemli -->
            <div id="problemli-page" class="page-content hidden">
                <div class="page-header">
                    <h2>‚ö†Ô∏è Problemli √úr√ºnler</h2>
                    <span class="badge warning">+ Ekle / - √áƒ±kar</span>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>Problem Takibi</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>√úr√ºn</th>
                                    <th>Temizleme</th><th>+</th><th>-</th>
                                    <th>Vuruk</th><th>+</th><th>-</th>
                                    <th>√áapaƒüƒ±</th><th>+</th><th>-</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-problemli"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Kalan -->
            <div id="kalan-page" class="page-content hidden">
                <div class="page-header">
                    <h2>üìä Kalan Par√ßalar</h2>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>Kalan Stok</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>√úr√ºn Kodu</th><th>Mevcut</th></tr></thead>
                            <tbody id="tbody-kalan"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ƒ∞≈ülem Ge√ßmi≈üi -->
            <div id="gecmis-page" class="page-content hidden">
                <div class="page-header">
                    <h2>üìú ƒ∞≈ülem Ge√ßmi≈üi</h2>
                    <button class="btn btn-danger" onclick="clearHistory()">Ge√ßmi≈üi Temizle</button>
                </div>
                <div class="table-container">
                    <div class="table-header"><h3>T√ºm ƒ∞≈ülemler</h3></div>
                    <div style="overflow-x:auto">
                        <table class="data-table">
                            <thead><tr><th>Tarih</th><th>ƒ∞≈ülem</th><th>√úr√ºn</th><th>Miktar</th><th>A√ßƒ±klama</th></tr></thead>
                            <tbody id="tbody-gecmis"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global Data - 41 √úR√úN
        let appData = {
            "anasayfa": [
                {"tip": "A", "urunKodu": "MXJ-YA2512M/R (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 2230, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 200, "problem": 0},
                {"tip": "B", "urunKodu": "MXJ-YA2512M/R (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 1804, "sevkEdilen": 200, "problem": 854},
                {"tip": "A", "urunKodu": "DIS-371-2GAT (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 1897, "sevkeHazir": 304, "kalan": 28, "sevkEdilen": 0, "problem": 66},
                {"tip": "B", "urunKodu": "DIS-371-2GAT (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 1448, "sevkeHazir": 304, "kalan": 347, "sevkEdilen": 0, "problem": 124},
                {"tip": "A", "urunKodu": "DIS-180-2GAT (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 3479, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "DIS-180-2GAT (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 3141, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "DIS-22-1GAT (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 229, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "DIS-22-1GAT (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 4, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "KHRQ22M20T (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 189, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "KHRQ22M20T (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 249, "sevkEdilen": 0, "problem": 9},
                {"tip": "A", "urunKodu": "FQG-335A (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 324, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-335A (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 166, "sevkEdilen": 0, "problem": 21},
                {"tip": "A", "urunKodu": "FQG-335A-Y (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 607, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-335A-Y (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 187, "sevkEdilen": 0, "problem": 19},
                {"tip": "A", "urunKodu": "FQG-B506A-Y (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 725, "sevkeHazir": 160, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-B506A-Y (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 671, "sevkeHazir": 160, "kalan": 70, "sevkEdilen": 0, "problem": 2},
                {"tip": "A", "urunKodu": "FQG-B730A-Y (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 1086, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-B730A-Y (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 1072, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "MXJ-YA1509M-R1 (A)", "toplamStok": 1495, "temizlemeyeGit": 1495, "temizlemede": 659, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "MXJ-YA1509M-R1 (B)", "toplamStok": 1492, "temizlemeyeGit": 1492, "temizlemede": 0, "sevkeHazir": 0, "kalan": 844, "sevkEdilen": 0, "problem": 273},
                {"tip": "A", "urunKodu": "MXJ-YA2815M/R (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 1154, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "MXJ-YA2815M/R (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 1161, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "CMY-Y102SS-TR (A)", "toplamStok": 1051, "temizlemeyeGit": 1051, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "CMY-Y102SS-TR (B)", "toplamStok": 1060, "temizlemeyeGit": 1060, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "FQG-04NAaA (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-04NAaA (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "HZG-30B (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "HZG-30B (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "C", "urunKodu": "HZG-30B (C)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "D", "urunKodu": "HZG-30B (D)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "HZG-20B (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "HZG-20B (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "FQG-B1350A (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-B1350A (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "FQG-B506 (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-B506 GRƒ∞ (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "FQG-B730 (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQG-B730 GRƒ∞ (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "A", "urunKodu": "FQ01B/A (A)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "B", "urunKodu": "FQ01B/A (B)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0},
                {"tip": "C", "urunKodu": "FQ01B/A (C)", "toplamStok": 0, "temizlemeyeGit": 0, "temizlemede": 0, "sevkeHazir": 0, "kalan": 0, "sevkEdilen": 0, "problem": 0}
            ],
            "temizlemeyeGidecek": [],
            "temizlemedOlan": [],
            "temizlemedenGelen": [],
            "sevkeHazir": [],
            "sevkEdilen": [{"urunKodu": "MXJ-YA2512M/R", "tarih": "24.10.2025", "adet": 200, "yer": "Fabrika", "irsaliye": "IRS2025000001077"}],
            "problemli": [],
            "kalan": [],
            "gecmis": []
        };

        // Init diƒüer listeler
        appData.anasayfa.forEach(item => {
            if (item.temizlemeyeGit > 0) {
                appData.temizlemeyeGidecek.push({urunKodu: item.urunKodu, mevcut: item.temizlemeyeGit});
            }
            if (item.temizlemede > 0) {
                appData.temizlemedOlan.push({urunKodu: item.urunKodu, mevcut: item.temizlemede});
            }
            if (item.kalan > 0 || item.urunKodu.includes('(A)') || item.urunKodu.includes('(B)')) {
                appData.temizlemedenGelen.push({urunKodu: item.urunKodu, mevcut: item.kalan});
            }
            if (item.problem > 0 || true) {
                appData.problemli.push({urunKodu: item.urunKodu, temizleme: item.problem, vuruk: 0, capagi: 0});
            }
            if (item.kalan > 0) {
                appData.kalan.push({urunKodu: item.urunKodu, mevcut: item.kalan});
            }
            const base = item.urunKodu.replace(' (A)', '').replace(' (B)', '').replace(' (C)', '').replace(' (D)', '');
            if (item.sevkeHazir > 0 && !appData.sevkeHazir.find(x => x.urunKodu === base)) {
                appData.sevkeHazir.push({urunKodu: base, mevcut: item.sevkeHazir});
            }
        });

        let currentPage = 'anasayfa';

        window.onload = function() {
            const saved = localStorage.getItem('stokData');
            if (saved) appData = JSON.parse(saved);
            renderAll();
            showToast('‚úÖ Sistem hazƒ±r! 41 √ºr√ºn y√ºkl√º', 'success');
        };

        function saveDB() {
            localStorage.setItem('stokData', JSON.stringify(appData));
        }

        function addHistory(islem, urun, miktar, aciklama) {
            appData.gecmis.unshift({
                tarih: new Date().toLocaleString('tr-TR'),
                islem: islem,
                urun: urun,
                miktar: miktar,
                aciklama: aciklama
            });
            saveDB();
        }

        function showPage(page) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            currentPage = page;
        }

        function showToast(msg, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? '‚úì' : '‚úó';
            toast.innerHTML = `<strong style="font-size:1.5rem">${icon}</strong><span>${msg}</span>`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function exportJSON() {
            const blob = new Blob([JSON.stringify(appData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `stok-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('üíæ JSON indirildi!', 'success');
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    appData = JSON.parse(e.target.result);
                    saveDB();
                    renderAll();
                    showToast('üì• JSON y√ºklendi!', 'success');
                } catch(err) {
                    showToast('‚ùå Hatalƒ± JSON!', 'error');
                }
            };
            reader.readAsText(file);
        }

        function renderAll() {
            renderTemizlemeye();
            renderTemizlemede();
            renderTemizlemeden();
            renderSevke();
            renderSevkedilen();
            renderProblemli();
            renderKalan();
            renderGecmis();
            renderAnasayfa(); // EN SON - T√ºm verileri topladƒ±ktan sonra
            updateStats();
        }

        // Ana Sayfa - OTOMATƒ∞K √ñZET
        function renderAnasayfa() {
            // √ñnce t√ºm verileri sƒ±fƒ±rla ve yeniden hesapla
            appData.anasayfa.forEach(item => {
                item.temizlemeyeGit = 0;
                item.temizlemede = 0;
                item.sevkeHazir = 0;
                item.kalan = 0;
                item.problem = 0;
            });
            
            // Temizlemeye Gidecek'ten al
            appData.temizlemeyeGidecek.forEach(item => {
                const idx = appData.anasayfa.findIndex(x => x.urunKodu === item.urunKodu);
                if (idx >= 0) appData.anasayfa[idx].temizlemeyeGit = item.mevcut;
            });
            
            // Temizlemede Olan'dan al
            appData.temizlemedOlan.forEach(item => {
                const idx = appData.anasayfa.findIndex(x => x.urunKodu === item.urunKodu);
                if (idx >= 0) appData.anasayfa[idx].temizlemede = item.mevcut;
            });
            
            // Kalan'dan al
            appData.kalan.forEach(item => {
                const idx = appData.anasayfa.findIndex(x => x.urunKodu === item.urunKodu);
                if (idx >= 0) appData.anasayfa[idx].kalan = item.mevcut;
            });
            
            // Problemli'den al
            appData.problemli.forEach(item => {
                const idx = appData.anasayfa.findIndex(x => x.urunKodu === item.urunKodu);
                if (idx >= 0) {
                    appData.anasayfa[idx].problem = item.temizleme + item.vuruk + item.capagi;
                }
            });
            
            // Sevke Hazƒ±r'dan al (base kod ile e≈üle≈ütir)
            appData.sevkeHazir.forEach(sevkeItem => {
                appData.anasayfa.forEach(item => {
                    const base = item.urunKodu.replace(' (A)', '').replace(' (B)', '').replace(' (C)', '').replace(' (D)', '');
                    if (base === sevkeItem.urunKodu) {
                        item.sevkeHazir = sevkeItem.mevcut;
                    }
                });
            });
            
            // Sevk Edilen'i hesapla
            const sevkMap = {};
            appData.sevkEdilen.forEach(item => {
                if (!sevkMap[item.urunKodu]) sevkMap[item.urunKodu] = 0;
                sevkMap[item.urunKodu] += item.adet;
            });
            Object.keys(sevkMap).forEach(base => {
                appData.anasayfa.forEach(item => {
                    const itemBase = item.urunKodu.replace(' (A)', '').replace(' (B)', '').replace(' (C)', '').replace(' (D)', '');
                    if (itemBase === base) {
                        item.sevkEdilen = sevkMap[base];
                    }
                });
            });
            
            // Render
            const tbody = document.getElementById('tbody-anasayfa');
            tbody.innerHTML = '';
            appData.anasayfa.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td contenteditable="true" class="editable" onblur="saveCell('anasayfa',${idx},'tip',this)">${item.tip}</td>
                    <td contenteditable="true" class="editable" onblur="saveCell('anasayfa',${idx},'urunKodu',this)">${item.urunKodu}</td>
                    <td contenteditable="true" class="editable" onblur="saveCell('anasayfa',${idx},'toplamStok',this)">${item.toplamStok}</td>
                    <td class="auto-cell" style="background:#fef3c7;">${item.temizlemeyeGit}</td>
                    <td class="auto-cell" style="background:#dbeafe;">${item.temizlemede}</td>
                    <td class="auto-cell" style="background:#d1fae5;">${item.sevkeHazir}</td>
                    <td class="auto-cell" style="background:#e5e7eb;">${item.kalan}</td>
                    <td class="auto-cell" style="background:#c7d2fe;">${item.sevkEdilen}</td>
                    <td class="auto-cell" style="background:#fee2e2;">${item.problem}</td>
                    <td><button class="btn btn-danger" onclick="deleteRow('anasayfa',${idx})">Sil</button></td>
                </tr>`;
            });
        }

        function saveCell(table, idx, field, el) {
            const val = el.textContent.trim();
            if (table === 'anasayfa') {
                appData.anasayfa[idx][field] = isNaN(val) ? val : parseInt(val);
                saveDB();
                showToast('‚úì Kaydedildi!', 'success');
                addHistory('D√ºzenleme', appData.anasayfa[idx].urunKodu, val, `${field} g√ºncellendi`);
            }
        }

        function updateStats() {
            const temizlemeye = appData.temizlemeyeGidecek.reduce((sum, x) => sum + x.mevcut, 0);
            const temizlemede = appData.temizlemedOlan.reduce((sum, x) => sum + x.mevcut, 0);
            const sevke = appData.sevkeHazir.reduce((sum, x) => sum + x.mevcut, 0);
            const problem = appData.problemli.reduce((sum, x) => sum + x.temizleme + x.vuruk + x.capagi, 0);
            
            document.getElementById('stat-temizlemeye').textContent = temizlemeye;
            document.getElementById('stat-temizlemede').textContent = temizlemede;
            document.getElementById('stat-sevke').textContent = sevke;
            document.getElementById('stat-problem').textContent = problem;
        }

        // Temizlemeye Gidecek
        function renderTemizlemeye() {
            const tbody = document.getElementById('tbody-temizlemeye');
            tbody.innerHTML = '';
            appData.temizlemeyeGidecek.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${item.urunKodu}</td>
                    <td contenteditable="true" class="editable" onblur="saveMevcut('temizlemeye',${idx},this)">${item.mevcut}</td>
                    <td><input type="number" class="input-cell input-yellow" placeholder="0" onkeypress="if(event.key==='Enter') sendToClean(${idx},this.value,this)"></td>
                    <td><button class="btn btn-danger" onclick="deleteRow('temizlemeye',${idx})">Sil</button></td>
                </tr>`;
            });
        }

        function saveMevcut(table, idx, el) {
            const val = parseInt(el.textContent.trim()) || 0;
            if (table === 'temizlemeye') {
                appData.temizlemeyeGidecek[idx].mevcut = val;
                saveDB();
                renderAll();
                showToast('‚úì G√ºncellendi!', 'success');
            }
        }

        function sendToClean(idx, miktar, input) {
            miktar = parseInt(miktar);
            if (!miktar || miktar <= 0) return showToast('‚ùå Ge√ßerli miktar!', 'error');
            if (appData.temizlemeyeGidecek[idx].mevcut < miktar) return showToast('‚ùå Yetersiz stok!', 'error');
            
            const urun = appData.temizlemeyeGidecek[idx].urunKodu;
            appData.temizlemeyeGidecek[idx].mevcut -= miktar;
            
            const idx2 = appData.temizlemedOlan.findIndex(x => x.urunKodu === urun);
            if (idx2 >= 0) appData.temizlemedOlan[idx2].mevcut += miktar;
            else appData.temizlemedOlan.push({urunKodu: urun, mevcut: miktar});
            
            saveDB();
            input.value = '';
            addHistory('Temizlemeye G√∂nder', urun, miktar, 'Temizlemeye g√∂nderildi');
            showToast(`‚úì ${miktar} adet g√∂nderildi!`, 'success');
            renderAll();
        }

        // Temizlemede Olan
        function renderTemizlemede() {
            const tbody = document.getElementById('tbody-temizlemede');
            tbody.innerHTML = '';
            appData.temizlemedOlan.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${item.urunKodu}</td>
                    <td contenteditable="true" class="editable" onblur="saveMevcutT(${idx},this)">${item.mevcut}</td>
                    <td><input type="number" class="input-cell input-green" placeholder="0" onkeypress="if(event.key==='Enter') finishClean(${idx},this.value,this)"></td>
                    <td><button class="btn btn-danger" onclick="deleteRow('temizlemede',${idx})">Sil</button></td>
                </tr>`;
            });
        }

        function saveMevcutT(idx, el) {
            appData.temizlemedOlan[idx].mevcut = parseInt(el.textContent.trim()) || 0;
            saveDB();
            renderAll();
            showToast('‚úì G√ºncellendi!', 'success');
        }

        function finishClean(idx, miktar, input) {
            miktar = parseInt(miktar);
            if (!miktar || miktar <= 0) return showToast('‚ùå Ge√ßerli miktar!', 'error');
            if (appData.temizlemedOlan[idx].mevcut < miktar) return showToast('‚ùå Yetersiz stok!', 'error');
            
            const urun = appData.temizlemedOlan[idx].urunKodu;
            appData.temizlemedOlan[idx].mevcut -= miktar;
            
            const idx2 = appData.temizlemedenGelen.findIndex(x => x.urunKodu === urun);
            if (idx2 >= 0) appData.temizlemedenGelen[idx2].mevcut += miktar;
            else appData.temizlemedenGelen.push({urunKodu: urun, mevcut: miktar});
            
            saveDB();
            input.value = '';
            addHistory('Temizleme Tamamlandƒ±', urun, miktar, 'Temizleme bitti');
            showToast(`‚úì ${miktar} adet tamamlandƒ±!`, 'success');
            renderAll();
        }

        // Temizlemeden Gelen - DOƒûRU A+B E≈ûLE≈ûTƒ∞RME
        function renderTemizlemeden() {
            const tbody = document.getElementById('tbody-temizlemeden');
            tbody.innerHTML = '';
            
            const grouped = {};
            appData.temizlemedenGelen.forEach(item => {
                const base = item.urunKodu.replace(' (A)', '').replace(' (B)', '');
                if (!grouped[base]) grouped[base] = {base: base, a: null, b: null};
                if (item.urunKodu.includes('(A)')) grouped[base].a = item;
                if (item.urunKodu.includes('(B)')) grouped[base].b = item;
            });
            
            Object.values(grouped).forEach(group => {
                if (group.a && group.b) {
                    tbody.innerHTML += `<tr>
                        <td>${group.base}</td>
                        <td>A:${group.a.mevcut} / B:${group.b.mevcut}</td>
                        <td><input type="number" class="input-cell input-green" id="inputA-${group.base.replace(/[^a-zA-Z0-9]/g, '')}" placeholder="A"></td>
                        <td><input type="number" class="input-cell input-green" id="inputB-${group.base.replace(/[^a-zA-Z0-9]/g, '')}" placeholder="B"></td>
                        <td><button class="btn btn-success" onclick="processAB('${group.base}')">E≈üle≈ütir</button></td>
                    </tr>`;
                }
            });
        }

        // DOƒûRU A+B LOGƒ∞C
        function processAB(base) {
            const safeBase = base.replace(/[^a-zA-Z0-9]/g, '');
            const inputA = parseInt(document.getElementById('inputA-' + safeBase).value) || 0;
            const inputB = parseInt(document.getElementById('inputB-' + safeBase).value) || 0;
            
            if (inputA <= 0 || inputB <= 0) return showToast('‚ùå A ve B girin!', 'error');
            
            const idxA = appData.temizlemedenGelen.findIndex(x => x.urunKodu === base + ' (A)');
            const idxB = appData.temizlemedenGelen.findIndex(x => x.urunKodu === base + ' (B)');
            
            if (idxA < 0 || idxB < 0) return;
            if (appData.temizlemedenGelen[idxA].mevcut < inputA) return showToast('‚ùå A yetersiz!', 'error');
            if (appData.temizlemedenGelen[idxB].mevcut < inputB) return showToast('‚ùå B yetersiz!', 'error');
            
            // DOƒûRU HESAPLAMA
            const minMiktar = Math.min(inputA, inputB);
            const fazlaA = inputA - minMiktar;
            const fazlaB = inputB - minMiktar;
            
            // Mevcuttan d√º≈ü
            appData.temizlemedenGelen[idxA].mevcut -= inputA;
            appData.temizlemedenGelen[idxB].mevcut -= inputB;
            
            // Sevke hazƒ±ra minimum ekle
            const sevkeIdx = appData.sevkeHazir.findIndex(x => x.urunKodu === base);
            if (sevkeIdx >= 0) {
                appData.sevkeHazir[sevkeIdx].mevcut += minMiktar;
            } else {
                appData.sevkeHazir.push({urunKodu: base, mevcut: minMiktar});
            }
            
            // Fazlalarƒ± kalana ekle
            if (fazlaA > 0) {
                const kalanIdxA = appData.kalan.findIndex(x => x.urunKodu === base + ' (A)');
                if (kalanIdxA >= 0) appData.kalan[kalanIdxA].mevcut += fazlaA;
                else appData.kalan.push({urunKodu: base + ' (A)', mevcut: fazlaA});
            }
            if (fazlaB > 0) {
                const kalanIdxB = appData.kalan.findIndex(x => x.urunKodu === base + ' (B)');
                if (kalanIdxB >= 0) appData.kalan[kalanIdxB].mevcut += fazlaB;
                else appData.kalan.push({urunKodu: base + ' (B)', mevcut: fazlaB});
            }
            
            saveDB();
            document.getElementById('inputA-' + safeBase).value = '';
            document.getElementById('inputB-' + safeBase).value = '';
            addHistory('A+B E≈üle≈ütir', base, minMiktar, `${minMiktar} set sevke${fazlaA > 0 ? ', A:'+fazlaA : ''}${fazlaB > 0 ? ', B:'+fazlaB : ''} kalana`);
            showToast(`‚úÖ ${minMiktar} set sevke!${fazlaA > 0 ? ' A:'+fazlaA : ''}${fazlaB > 0 ? ' B:'+fazlaB : ''} kalana`, 'success');
            renderAll();
        }

        // Sevke Hazƒ±r - MANUEL ƒ∞RSALƒ∞YE
        function renderSevke() {
            const tbody = document.getElementById('tbody-sevke');
            tbody.innerHTML = '';
            appData.sevkeHazir.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${item.urunKodu}</td>
                    <td contenteditable="true" class="editable" onblur="saveMevcutS(${idx},this)">${item.mevcut}</td>
                    <td><input type="number" class="input-cell input-green" id="adet-${idx}" placeholder="Adet"></td>
                    <td><input type="text" class="input-cell input-yellow" id="irsaliye-${idx}" placeholder="ƒ∞rsaliye" style="width:120px"></td>
                    <td><input type="text" class="input-cell input-yellow" id="yer-${idx}" placeholder="Yer" value="Fabrika"></td>
                    <td><button class="btn btn-success" onclick="shipProduct(${idx})">Sevk Et</button></td>
                </tr>`;
            });
        }

        function saveMevcutS(idx, el) {
            appData.sevkeHazir[idx].mevcut = parseInt(el.textContent.trim()) || 0;
            saveDB();
            renderAll();
        }

        function shipProduct(idx) {
            const adet = parseInt(document.getElementById('adet-' + idx).value) || 0;
            const irsaliye = document.getElementById('irsaliye-' + idx).value.trim();
            const yer = document.getElementById('yer-' + idx).value.trim() || 'Fabrika';
            
            if (adet <= 0) return showToast('‚ùå Adet girin!', 'error');
            if (!irsaliye) return showToast('‚ùå ƒ∞rsaliye girin!', 'error');
            if (appData.sevkeHazir[idx].mevcut < adet) return showToast('‚ùå Yetersiz stok!', 'error');
            
            appData.sevkeHazir[idx].mevcut -= adet;
            appData.sevkEdilen.push({
                urunKodu: appData.sevkeHazir[idx].urunKodu,
                tarih: new Date().toLocaleDateString('tr-TR'),
                adet: adet,
                yer: yer,
                irsaliye: irsaliye
            });
            
            saveDB();
            document.getElementById('adet-' + idx).value = '';
            document.getElementById('irsaliye-' + idx).value = '';
            addHistory('Sevk Edildi', appData.sevkeHazir[idx].urunKodu, adet, `ƒ∞rsaliye: ${irsaliye}`);
            showToast(`‚úÖ ${adet} adet sevk edildi!`, 'success');
            renderAll();
        }

        // Sevk Edilen
        function renderSevkedilen() {
            const tbody = document.getElementById('tbody-sevkedilen');
            tbody.innerHTML = '';
            appData.sevkEdilen.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${item.urunKodu}</td>
                    <td>${item.tarih}</td>
                    <td>${item.adet}</td>
                    <td>${item.irsaliye || '-'}</td>
                    <td>${item.yer}</td>
                </tr>`;
            });
        }

        // Problemli
        function renderProblemli() {
            const tbody = document.getElementById('tbody-problemli');
            tbody.innerHTML = '';
            appData.problemli.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${item.urunKodu}</td>
                    <td>${item.temizleme}</td>
                    <td><input type="number" class="input-cell input-green" placeholder="0" onkeypress="if(event.key==='Enter') addProblem(${idx},'temizleme',this.value,this)"></td>
                    <td><input type="number" class="input-cell input-red" placeholder="0" onkeypress="if(event.key==='Enter') removeProblem(${idx},'temizleme',this.value,this)"></td>
                    <td>${item.vuruk}</td>
                    <td><input type="number" class="input-cell input-green" placeholder="0" onkeypress="if(event.key==='Enter') addProblem(${idx},'vuruk',this.value,this)"></td>
                    <td><input type="number" class="input-cell input-red" placeholder="0" onkeypress="if(event.key==='Enter') removeProblem(${idx},'vuruk',this.value,this)"></td>
                    <td>${item.capagi}</td>
                    <td><input type="number" class="input-cell input-green" placeholder="0" onkeypress="if(event.key==='Enter') addProblem(${idx},'capagi',this.value,this)"></td>
                    <td><input type="number" class="input-cell input-red" placeholder="0" onkeypress="if(event.key==='Enter') removeProblem(${idx},'capagi',this.value,this)"></td>
                </tr>`;
            });
        }

        function addProblem(idx, field, miktar, input) {
            miktar = parseInt(miktar);
            if (!miktar || miktar <= 0) return;
            appData.problemli[idx][field] += miktar;
            saveDB();
            input.value = '';
            renderAll();
            showToast(`‚úì +${miktar} eklendi!`, 'success');
        }

        function removeProblem(idx, field, miktar, input) {
            miktar = parseInt(miktar);
            if (!miktar || miktar <= 0) return;
            if (appData.problemli[idx][field] < miktar) return showToast('‚ùå Yetersiz!', 'error');
            appData.problemli[idx][field] -= miktar;
            saveDB();
            input.value = '';
            renderAll();
            showToast(`‚úì -${miktar} √ßƒ±karƒ±ldƒ±!`, 'success');
        }

        // Kalan
        function renderKalan() {
            const tbody = document.getElementById('tbody-kalan');
            tbody.innerHTML = '';
            appData.kalan.forEach((item, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${item.urunKodu}</td>
                    <td contenteditable="true" class="editable" onblur="saveMevcutK(${idx},this)">${item.mevcut}</td>
                </tr>`;
            });
        }

        function saveMevcutK(idx, el) {
            appData.kalan[idx].mevcut = parseInt(el.textContent.trim()) || 0;
            saveDB();
            renderAll();
        }

        // ƒ∞≈ülem Ge√ßmi≈üi
        function renderGecmis() {
            const tbody = document.getElementById('tbody-gecmis');
            tbody.innerHTML = '';
            appData.gecmis.forEach(item => {
                tbody.innerHTML += `<tr>
                    <td>${item.tarih}</td>
                    <td>${item.islem}</td>
                    <td>${item.urun}</td>
                    <td>${item.miktar}</td>
                    <td>${item.aciklama}</td>
                </tr>`;
            });
        }

        function clearHistory() {
            if (!confirm('Ge√ßmi≈üi temizle?')) return;
            appData.gecmis = [];
            saveDB();
            renderGecmis();
            showToast('‚úì Ge√ßmi≈ü temizlendi!', 'success');
        }

        // Yeni satƒ±r ekle
        function addNewRow(table) {
            const urun = prompt('√úr√ºn kodu:');
            if (!urun) return;
            
            if (table === 'anasayfa') {
                appData.anasayfa.push({tip: 'A', urunKodu: urun, toplamStok: 0, temizlemeyeGit: 0, temizlemede: 0, sevkeHazir: 0, kalan: 0, sevkEdilen: 0, problem: 0});
            } else if (table === 'temizlemeye') {
                appData.temizlemeyeGidecek.push({urunKodu: urun, mevcut: 0});
            } else if (table === 'temizlemede') {
                appData.temizlemedOlan.push({urunKodu: urun, mevcut: 0});
            }
            
            saveDB();
            renderAll();
            showToast('‚úì Eklendi!', 'success');
        }

        // Satƒ±r sil
        function deleteRow(table, idx) {
            if (!confirm('Silmek istediƒüinden emin misin?')) return;
            
            if (table === 'anasayfa') appData.anasayfa.splice(idx, 1);
            else if (table === 'temizlemeye') appData.temizlemeyeGidecek.splice(idx, 1);
            else if (table === 'temizlemede') appData.temizlemedOlan.splice(idx, 1);
            
            saveDB();
            renderAll();
            showToast('‚úì Silindi!', 'success');
        }
    </script>
</body>
</html>
